<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=9" >

<title>Visualization and analysis for Simes dendrochronology ms.</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<h1>Visualization and analysis for Simes dendrochronology ms.</h1>

<p>Load required libraries</p>

<pre><code class="r">library(dplR)
</code></pre>

<pre><code>## Warning: package &#39;dplR&#39; was built under R version 3.0.2
</code></pre>

<pre><code class="r">library(zoo)
</code></pre>

<pre><code>## Warning: package &#39;zoo&#39; was built under R version 3.0.2
</code></pre>

<pre><code>## 
## Attaching package: &#39;zoo&#39;
## 
## The following object is masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric
</code></pre>

<pre><code class="r">library(ggplot2)
library(gdata)
</code></pre>

<pre><code>## Warning: running command &#39;&quot;C:\PROGRA~1\MIKTEX~1.9\miktex\bin\perl.exe&quot;
## &quot;C:/Users/aellison/Documents/R/win-library/3.0/gdata/perl/supportedFormats.pl&quot;&#39;
## had status 2
</code></pre>

<pre><code>## gdata: Unable to load perl libaries needed by read.xls()
## gdata: to support &#39;XLX&#39; (Excel 97-2004) files.
## 
## gdata: Unable to load perl libaries needed by read.xls()
## gdata: to support &#39;XLSX&#39; (Excel 2007+) files.
## 
## gdata: Run the function &#39;installXLSXsupport()&#39;
## gdata: to automatically download and install the perl
## gdata: libaries needed to support Excel XLS and XLSX formats.
## 
## Attaching package: &#39;gdata&#39;
## 
## The following object is masked from &#39;package:stats&#39;:
## 
##     nobs
## 
## The following object is masked from &#39;package:utils&#39;:
## 
##     object.size
</code></pre>

<pre><code class="r">library(grid)
library(mgcv)
</code></pre>

<pre><code>## This is mgcv 1.7-24. For overview type &#39;help(&quot;mgcv-package&quot;)&#39;.
</code></pre>

<pre><code class="r">library(akima)
library(spatstat)
</code></pre>

<pre><code>## Loading required package: deldir
## deldir 0.0-22
## spatstat 1.31-3 
## Type &#39;help(spatstat)&#39; for an overview of spatstat 
##      &#39;latest.news()&#39; for news on latest version 
##      &#39;licence.polygons()&#39; for licence information on polygon calculations
</code></pre>

<p>Generate required custom functions filled.contour3 and multiplot</p>

<p>filled.contour3 from: <a href="http://wiki.cbr.washington.edu/qerm/sites/qerm/images/1/16/Filled.contour3.R">http://wiki.cbr.washington.edu/qerm/sites/qerm/images/1/16/Filled.contour3.R</a></p>

<p>Multiplot is from R cookbook: 
<a href="http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_%28ggplot2%29/">http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_%28ggplot2%29/</a></p>

<pre><code class="r">filled.contour3 &lt;- function(x = seq(0, 1, length.out = nrow(z)), y = seq(0, 
    1, length.out = ncol(z)), z, xlim = range(x, finite = TRUE), ylim = range(y, 
    finite = TRUE), zlim = range(z, finite = TRUE), levels = pretty(zlim, nlevels), 
    nlevels = 20, color.palette = cm.colors, col = color.palette(length(levels) - 
        1), plot.title, plot.axes, key.title, key.axes, asp = NA, xaxs = &quot;i&quot;, 
    yaxs = &quot;i&quot;, las = 1, axes = TRUE, frame.plot = axes, mar, ...) {
    # modification by Ian Taylor of the filled.contour function to remove the
    # key and facilitate overplotting with contour() further modified by Carey
    # McGilliard and Bridget Ferris to allow multiple plots on one page

    if (missing(z)) {
        if (!missing(x)) {
            if (is.list(x)) {
                z &lt;- x$z
                y &lt;- x$y
                x &lt;- x$x
            } else {
                z &lt;- x
                x &lt;- seq.int(0, 1, length.out = nrow(z))
            }
        } else stop(&quot;no &#39;z&#39; matrix specified&quot;)
    } else if (is.list(x)) {
        y &lt;- x$y
        x &lt;- x$x
    }
    if (any(diff(x) &lt;= 0) || any(diff(y) &lt;= 0)) 
        stop(&quot;increasing &#39;x&#39; and &#39;y&#39; values expected&quot;)
    # mar.orig &lt;- (par.orig &lt;- par(c(&#39;mar&#39;, &#39;las&#39;, &#39;mfrow&#39;)))$mar
    # on.exit(par(par.orig)) w &lt;- (3 + mar.orig[2]) * par(&#39;csi&#39;) * 2.54 par(las
    # = las) mar &lt;- mar.orig
    plot.new()
    # par(mar=mar)
    plot.window(xlim, ylim, &quot;&quot;, xaxs = xaxs, yaxs = yaxs, asp = asp)
    if (!is.matrix(z) || nrow(z) &lt;= 1 || ncol(z) &lt;= 1) 
        stop(&quot;no proper &#39;z&#39; matrix specified&quot;)
    if (!is.double(z)) 
        storage.mode(z) &lt;- &quot;double&quot;
    .filled.contour(as.double(x), as.double(y), z, as.double(levels), col = col)
    if (missing(plot.axes)) {
        if (axes) {
            title(main = &quot;&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;)
            Axis(x, side = 1)
            Axis(y, side = 2)
        }
    } else plot.axes
    if (frame.plot) 
        box()
    if (missing(plot.title)) 
        title(...) else plot.title
    invisible()
}


# Multiple plot function ggplot objects can be passed in ..., or to plotlist
# (as a list of ggplot objects) - cols: Number of columns in layout -
# layout: A matrix specifying the layout. If present, &#39;cols&#39; is ignored.  If
# the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE), then
# plot 1 will go in the upper left, 2 will go in the upper right, and 3 will
# go all the way across the bottom.
multiplot &lt;- function(..., plotlist = NULL, file, cols = 1, layout = NULL) {
    require(grid)

    # Make a list from the ... arguments and plotlist
    plots &lt;- c(list(...), plotlist)

    numPlots = length(plots)

    # If layout is NULL, then use &#39;cols&#39; to determine layout
    if (is.null(layout)) {
        # Make the panel ncol: Number of columns of plots nrow: Number of rows
        # needed, calculated from # of cols
        layout &lt;- matrix(seq(1, cols * ceiling(numPlots/cols)), ncol = cols, 
            nrow = ceiling(numPlots/cols))
    }

    if (numPlots == 1) {
        print(plots[[1]])

    } else {
        # Set up the page
        grid.newpage()
        pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

        # Make each plot, in the correct location
        for (i in 1:numPlots) {
            # Get the i,j matrix positions of the regions that contain this subplot
            matchidx &lt;- as.data.frame(which(layout == i, arr.ind = TRUE))

            print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row, layout.pos.col = matchidx$col))
        }
    }
}
</code></pre>

<p>Read in raw data files</p>

<pre><code class="r">trees &lt;- read.csv(&quot;C:/Users/aellison/Dropbox/Aaron&#39;s Briefcase/manuscript - Simes dendro and land use/analysis/trees03.csv&quot;)
dendro &lt;- read.csv(&quot;C:/Users/aellison/Dropbox/Aaron&#39;s Briefcase/manuscript - Simes dendro and land use/analysis/hf086-01-dendro.csv&quot;)

head(trees)
</code></pre>

<pre><code>##   plot sec tree genus species  dbh   cc live xcoord ycoord zelev elev0
## 1    1   C  501 Tsuga    TSCA 13.4 &lt;NA&gt;    D   30.1   37.6 -2.57 50;40
## 2    1   C  512 Tsuga    TSCA 29.0    C    L   30.1   51.7 -3.28 50;40
## 3    1   C  507 Tsuga    TSCA 12.3    S    L   30.8   44.5 -3.17 50;40
## 4    1   C  513 Tsuga    TSCA 43.8    D    L   31.3   55.1 -3.50 50;40
## 5    1   C  502  Acer    ACRU  9.0    S    L   31.5   40.3 -3.03 50;40
## 6    1   C  506 Tsuga    TSCA  9.9    S    L   31.8   43.5 -3.22 50;40
</code></pre>

<pre><code class="r">head(dendro)
</code></pre>

<pre><code>##   Plot Genus Species Code TreeNum Year mmperyear
## 1    1  Acer  rubrum ACRU     532 1935     1.275
## 2    1  Acer  rubrum ACRU     532 1936     1.519
## 3    1  Acer  rubrum ACRU     532 1937     1.375
## 4    1  Acer  rubrum ACRU     532 1938     0.891
## 5    1  Acer  rubrum ACRU     532 1939     0.737
## 6    1  Acer  rubrum ACRU     532 1940     1.139
</code></pre>

<p>Create contour plots of trees in each plot (ms. Figures 5, 6)</p>

<pre><code class="r">
# extract tree location data for each plot
attach(trees)
plot.1 &lt;- trees[plot == 1, ]
plot.2 &lt;- trees[plot == 2, ]
plot.3 &lt;- trees[plot == 3, ]
plot.4 &lt;- trees[plot == 4, ]
plot.5 &lt;- trees[plot == 5, ]
plot.6 &lt;- trees[plot == 6, ]
plot.7 &lt;- trees[plot == 7, ]
plot.8 &lt;- trees[plot == 8, ]

genera &lt;- levels(genus)

detach(trees)

# remove NAs
p1 &lt;- na.omit(plot.1)
p2 &lt;- na.omit(plot.2)
p3 &lt;- na.omit(plot.3)
p4 &lt;- na.omit(plot.4)
p5 &lt;- na.omit(plot.5)
p6 &lt;- na.omit(plot.6)
p7 &lt;- na.omit(plot.7)
p8 &lt;- na.omit(plot.8)

# set up contour plot grids
p.1.i &lt;- interp(p1$xcoord, p1$ycoord, scale(p1$zelev), xo = seq(0, 90, length = 40), 
    yo = seq(0, 90, length = 40), duplicate = &quot;strip&quot;, extrap = FALSE, linear = FALSE)

p.2.i &lt;- interp(p2$xcoord, p2$ycoord, scale(p2$zelev), xo = seq(0, 90, length = 40), 
    yo = seq(0, 90, length = 40), duplicate = &quot;strip&quot;, extrap = FALSE, linear = FALSE)
p.3.i &lt;- interp(p3$xcoord, p3$ycoord, scale(p3$zelev), xo = seq(0, 90, length = 40), 
    yo = seq(0, 90, length = 40), duplicate = &quot;strip&quot;, extrap = FALSE, linear = FALSE)
p.4.i &lt;- interp(p4$xcoord, p4$ycoord, scale(p4$zelev), xo = seq(0, 90, length = 40), 
    yo = seq(0, 90, length = 40), duplicate = &quot;strip&quot;, extrap = FALSE, linear = FALSE)
p.5.i &lt;- interp(p5$xcoord, p5$ycoord, scale(p5$zelev), xo = seq(0, 90, length = 40), 
    yo = seq(0, 90, length = 40), duplicate = &quot;strip&quot;, extrap = FALSE, linear = FALSE)
p.6.i &lt;- interp(p6$xcoord, p6$ycoord, scale(p6$zelev), xo = seq(0, 90, length = 40), 
    yo = seq(0, 90, length = 40), duplicate = &quot;strip&quot;, extrap = FALSE, linear = FALSE)
p.7.i &lt;- interp(p7$xcoord, p7$ycoord, scale(p7$zelev), xo = seq(0, 90, length = 40), 
    yo = seq(0, 90, length = 40), duplicate = &quot;strip&quot;, extrap = FALSE, linear = FALSE)
p.8.i &lt;- interp(p8$xcoord, p8$ycoord, scale(p8$zelev), xo = seq(0, 90, length = 40), 
    yo = seq(0, 90, length = 40), duplicate = &quot;strip&quot;, extrap = FALSE, linear = FALSE)


# set color palette for genera

genera.colors.1 &lt;- c(&quot;firebrick4&quot;, &quot;coral&quot;, &quot;black&quot;, &quot;black&quot;, &quot;black&quot;, &quot;black&quot;, 
    &quot;black&quot;, &quot;black&quot;, &quot;black&quot;, &quot;olivedrab3&quot;, &quot;black&quot;, &quot;tan4&quot;, &quot;black&quot;, &quot;darkgreen&quot;)

genera.rank &lt;- c(14, 2, 1, 12, 10, 7, 9, 4, 11, 8, 3, 6, 5, 13)

cex.I &lt;- c(0.6, 0.6, rep(0.3, 7), 0.6, 0.3, 0.6, 0.3, 0.6)

# begin hemlock plot uncomment pdf and dev.off() lines to generate pdfs

# pdf(file=&#39;hemlock_countors.pdf&#39;, width=4.75, height=6, colormodel=&#39;cmyk&#39;,
# pointsize=9)

layout(matrix(c(1, 6, 2, 5, 3, 4, 0, 0, 7, 7), 5, 2, byrow = TRUE), widths = rep(lcm(4.08), 
    2), heights = c(rep(lcm(4.08), 3), lcm(0.75), lcm(1.5)))
# layout.show(7)
par(pin = c(1.75, 1.75), plt = c(0.0625, 0.9375, 0.0625, 0.9375))


filled.contour3(p.1.i, xlim = c(0, 90), ylim = c(0, 90), axes = FALSE, nlevels = 5)

for (i in 1:length(genera)) {
    points(plot.1$xcoord[plot.1$genus == genera[i]], plot.1$ycoord[plot.1$genus == 
        genera[i]], col = genera.colors.1[i], pch = 19, cex = cex.I[i])
}
axis(1, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(2, at = seq(0, 80, 20), labels = TRUE, tcl = -0.25, lwd = 2, font.axis = 2)
axis(3, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(4, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
box(lwd = 2)
rect(30, 30, 60, 60, border = &quot;black&quot;, lty = &quot;solid&quot;, lwd = 1)
mtext(&quot;Valley&quot;, side = 3, font = 2, padj = -1, cex = 1)

filled.contour3(p.2.i, xlim = c(0, 90), ylim = c(0, 90), axes = FALSE, nlevels = 5)

for (i in 1:length(genera)) {
    points(plot.2$xcoord[plot.2$genus == genera[i]], plot.2$ycoord[plot.2$genus == 
        genera[i]], col = genera.colors.1[i], pch = 19, cex = cex.I[i])
}
axis(1, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(2, at = seq(0, 80, 20), labels = TRUE, tcl = -0.25, lwd = 2, font.axis = 2)
axis(3, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(4, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
box(lwd = 2)
rect(30, 30, 60, 60, border = &quot;black&quot;, lty = &quot;solid&quot;, lwd = 1)

mtext(&quot;Meters&quot;, side = 2, font = 2, padj = -3, cex = 0.85)

filled.contour3(p.3.i, xlim = c(0, 90), ylim = c(0, 90), axes = FALSE, nlevels = 5)

for (i in 1:length(genera)) {
    points(plot.3$xcoord[plot.3$genus == genera[i]], plot.3$ycoord[plot.3$genus == 
        genera[i]], col = genera.colors.1[i], pch = 19, cex = cex.I[i])
}
axis(1, at = seq(0, 80, 20), labels = TRUE, tcl = -0.25, lwd = 2, font.axis = 2)
axis(2, at = seq(0, 80, 20), labels = TRUE, tcl = -0.25, lwd = 2, font.axis = 2)
axis(3, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(4, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
box(lwd = 2)
rect(30, 30, 60, 60, border = &quot;black&quot;, lty = &quot;solid&quot;, lwd = 1)

filled.contour3(p.4.i, xlim = c(0, 90), ylim = c(0, 90), axes = FALSE, nlevels = 5)

for (i in 1:length(genera)) {
    points(plot.4$xcoord[plot.4$genus == genera[i]], plot.4$ycoord[plot.4$genus == 
        genera[i]], col = genera.colors.1[i], pch = 19, cex = cex.I[i])
}
axis(1, at = seq(0, 80, 20), labels = TRUE, tcl = -0.25, lwd = 2, font.axis = 2)
axis(2, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(3, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(4, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
box(lwd = 2)
rect(30, 30, 60, 60, border = &quot;black&quot;, lty = &quot;solid&quot;, lwd = 1)

mtext(&quot;Meters&quot;, side = 1, font = 2, padj = 3, adj = -0.35, cex = 0.85)

filled.contour3(p.5.i, xlim = c(0, 90), ylim = c(0, 90), axes = FALSE, nlevels = 5)

for (i in 1:length(genera)) {
    points(plot.5$xcoord[plot.5$genus == genera[i]], plot.5$ycoord[plot.5$genus == 
        genera[i]], col = genera.colors.1[i], pch = 19, cex = cex.I[i])
}
axis(1, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(2, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(3, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(4, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
box(lwd = 2)
rect(30, 30, 60, 60, border = &quot;black&quot;, lty = &quot;solid&quot;, lwd = 1)


filled.contour3(p.6.i, xlim = c(0, 90), ylim = c(0, 90), axes = FALSE, nlevels = 5)

for (i in 1:length(genera)) {
    points(plot.6$xcoord[plot.6$genus == genera[i]], plot.6$ycoord[plot.6$genus == 
        genera[i]], col = genera.colors.1[i], pch = 19, cex = cex.I[i])
}
axis(1, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(2, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(3, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(4, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
box(lwd = 2)
rect(30, 30, 60, 60, border = &quot;black&quot;, lty = &quot;solid&quot;, lwd = 1)

mtext(&quot;Ridge&quot;, side = 3, font = 2, padj = -1, cex = 1)

genera.colors.1 &lt;- c(&quot;firebrick4&quot;, &quot;coral&quot;, &quot;black&quot;, &quot;black&quot;, &quot;black&quot;, &quot;black&quot;, 
    &quot;black&quot;, &quot;black&quot;, &quot;black&quot;, &quot;olivedrab3&quot;, &quot;black&quot;, &quot;tan4&quot;, &quot;black&quot;, &quot;darkgreen&quot;)

genera.rank &lt;- c(14, 2, 1, 12, 10, 7, 9, 4, 11, 8, 3, 6, 5, 13)

image(1:6, 1, as.matrix(1:6), col = genera.colors.1[genera.rank[1:6]], xlab = &quot;&quot;, 
    ylab = &quot;&quot;, xaxt = &quot;n&quot;, yaxt = &quot;n&quot;, bty = &quot;n&quot;)
blacks &lt;- c(2, 5)
whites &lt;- c(1, 3, 4)
for (i in whites) text(i, 1, genera[genera.rank][i], font = 4, col = &quot;white&quot;, 
    srt = 90)
for (i in blacks) text(i, 1, genera[genera.rank][i], font = 4, col = &quot;black&quot;, 
    srt = 90)
text(6, 1, &quot;Other&quot;, font = 2, col = &quot;white&quot;, srt = 90)
</code></pre>

<p><img src="figure/unnamed-chunk-41.png" alt="plot of chunk unnamed-chunk-4"/> </p>

<pre><code class="r">
# dev.off() end hemlock



# begin hardwoods

# pdf(file=&#39;hardwood_countors.pdf&#39;, width=4.75, height=6, colormodel=&#39;cmyk&#39;,
# pointsize=9)

layout(matrix(c(2, 1, 0, 0, 3, 3), 3, 2, byrow = TRUE), widths = rep(lcm(4.08), 
    2), heights = c(rep(lcm(4.08), 1), lcm(0.75), lcm(1.5)))
# layout.show(3)

par(pin = c(1.75, 1.75), plt = c(0.0625, 0.9375, 0.0625, 0.9375))

filled.contour3(p.7.i, xlim = c(0, 90), ylim = c(0, 90), axes = FALSE, nlevels = 5)

for (i in 1:length(genera)) {
    points(plot.7$xcoord[plot.7$genus == genera[i]], plot.7$ycoord[plot.7$genus == 
        genera[i]], col = genera.colors.1[i], pch = 19, cex = cex.I[i])
}
axis(1, at = seq(0, 80, 20), labels = TRUE, tcl = -0.25, lwd = 2, font.axis = 2)
axis(2, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2, font.axis = 2)
axis(3, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(4, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
box(lwd = 2)
rect(30, 30, 60, 60, border = &quot;black&quot;, lty = &quot;solid&quot;, lwd = 1)
mtext(&quot;Meters&quot;, side = 1, font = 2, padj = 3, adj = -0.35, cex = 0.85)
mtext(&quot;Ridge&quot;, side = 3, font = 2, padj = -1, cex = 1)
filled.contour3(p.8.i, xlim = c(0, 90), ylim = c(0, 90), axes = FALSE, nlevels = 5)

for (i in 1:length(genera)) {
    points(plot.8$xcoord[plot.8$genus == genera[i]], plot.8$ycoord[plot.8$genus == 
        genera[i]], col = genera.colors.1[i], pch = 19, cex = cex.I[i])
}
axis(1, at = seq(0, 80, 20), labels = TRUE, tcl = -0.25, lwd = 2, font.axis = 2)
axis(2, at = seq(0, 80, 20), labels = TRUE, tcl = -0.25, lwd = 2, font.axis = 2)
axis(3, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
axis(4, at = seq(0, 80, 20), labels = FALSE, tcl = -0.25, lwd = 2)
box(lwd = 2)
rect(30, 30, 60, 60, border = &quot;black&quot;, lty = &quot;solid&quot;, lwd = 1)
mtext(&quot;Meters&quot;, side = 2, font = 2, padj = -3, cex = 0.85)
mtext(&quot;Valley&quot;, side = 3, font = 2, padj = -1, cex = 1)

genera.colors.1 &lt;- c(&quot;firebrick4&quot;, &quot;coral&quot;, &quot;black&quot;, &quot;black&quot;, &quot;black&quot;, &quot;black&quot;, 
    &quot;black&quot;, &quot;black&quot;, &quot;black&quot;, &quot;olivedrab3&quot;, &quot;black&quot;, &quot;tan4&quot;, &quot;black&quot;, &quot;darkgreen&quot;)

genera.rank &lt;- c(14, 2, 1, 12, 10, 7, 9, 4, 11, 8, 3, 6, 5, 13)

image(1:6, 1, as.matrix(1:6), col = genera.colors.1[genera.rank[1:6]], xlab = &quot;&quot;, 
    ylab = &quot;&quot;, xaxt = &quot;n&quot;, yaxt = &quot;n&quot;, bty = &quot;n&quot;)
blacks &lt;- c(2, 5)
whites &lt;- c(1, 3, 4)
for (i in whites) text(i, 1, genera[genera.rank][i], font = 4, col = &quot;white&quot;, 
    srt = 90)
for (i in blacks) text(i, 1, genera[genera.rank][i], font = 4, col = &quot;black&quot;, 
    srt = 90)
text(6, 1, &quot;Other&quot;, font = 2, col = &quot;white&quot;, srt = 90)

# dev.off()
</code></pre>

<p><img src="figure/unnamed-chunk-42.png" alt="plot of chunk unnamed-chunk-4"/> </p>

<p>Compute Ripley&#39;s K for each species, each plot</p>

<p>First, create sptaial point patterns; remove points with x or y outside of c(0,90)</p>

<pre><code class="r">
plot.1 &lt;- plot.1[plot.1[, 9] &gt;= 0 &amp; plot.1[, 9] &lt;= 90, ]
plot.1 &lt;- plot.1[plot.1[, 10] &gt;= 0 &amp; plot.1[, 10] &lt;= 90, ]
plot.1.pp &lt;- ppp(plot.1[, 9], plot.1[, 10], c(0, 90), c(0, 90))
</code></pre>

<pre><code>## Warning: data contain duplicated points
</code></pre>

<pre><code class="r">
plot.2 &lt;- plot.2[plot.2[, 9] &gt;= 0 &amp; plot.2[, 9] &lt;= 90, ]
plot.2 &lt;- plot.2[plot.2[, 10] &gt;= 0 &amp; plot.2[, 10] &lt;= 90, ]
plot.2.pp &lt;- ppp(plot.2[, 9], plot.2[, 10], c(0, 90), c(0, 90))
</code></pre>

<pre><code>## Warning: data contain duplicated points
</code></pre>

<pre><code class="r">
plot.3 &lt;- plot.3[plot.3[, 9] &gt;= 0 &amp; plot.3[, 9] &lt;= 90, ]
plot.3 &lt;- plot.3[plot.3[, 10] &gt;= 0 &amp; plot.3[, 10] &lt;= 90, ]
plot.3.pp &lt;- ppp(plot.3[, 9], plot.3[, 10], c(0, 90), c(0, 90))
</code></pre>

<pre><code>## Warning: data contain duplicated points
</code></pre>

<pre><code class="r">
plot.4 &lt;- plot.4[plot.4[, 9] &gt;= 0 &amp; plot.4[, 9] &lt;= 90, ]
plot.4 &lt;- plot.4[plot.4[, 10] &gt;= 0 &amp; plot.4[, 10] &lt;= 90, ]
plot.4.pp &lt;- ppp(plot.4[, 9], plot.4[, 10], c(0, 90), c(0, 90))
</code></pre>

<pre><code>## Warning: data contain duplicated points
</code></pre>

<pre><code class="r">
plot.5 &lt;- plot.5[plot.5[, 9] &gt;= 0 &amp; plot.5[, 9] &lt;= 90, ]
plot.5 &lt;- plot.5[plot.5[, 10] &gt;= 0 &amp; plot.5[, 10] &lt;= 90, ]
plot.5.pp &lt;- ppp(plot.5[, 9], plot.5[, 10], c(0, 90), c(0, 90))
</code></pre>

<pre><code>## Warning: data contain duplicated points
</code></pre>

<pre><code class="r">
plot.6 &lt;- plot.6[plot.6[, 9] &gt;= 0 &amp; plot.6[, 9] &lt;= 90, ]
plot.6 &lt;- plot.6[plot.6[, 10] &gt;= 0 &amp; plot.6[, 10] &lt;= 90, ]
plot.6.pp &lt;- ppp(plot.6[, 9], plot.6[, 10], c(0, 90), c(0, 90))
</code></pre>

<pre><code>## Warning: data contain duplicated points
</code></pre>

<pre><code class="r">
plot.7 &lt;- plot.7[plot.7[, 9] &gt;= 0 &amp; plot.7[, 9] &lt;= 90, ]
plot.7 &lt;- plot.7[plot.7[, 10] &gt;= 0 &amp; plot.7[, 10] &lt;= 90, ]
plot.7.pp &lt;- ppp(plot.7[, 9], plot.7[, 10], c(0, 90), c(0, 90))
</code></pre>

<pre><code>## Warning: data contain duplicated points
</code></pre>

<pre><code class="r">
plot.8 &lt;- plot.8[plot.8[, 9] &gt;= 0 &amp; plot.8[, 9] &lt;= 90, ]
plot.8 &lt;- plot.8[plot.8[, 10] &gt;= 0 &amp; plot.8[, 10] &lt;= 90, ]
plot.8.pp &lt;- ppp(plot.8[, 9], plot.8[, 10], c(0, 90), c(0, 90))
</code></pre>

<pre><code>## Warning: data contain duplicated points
</code></pre>

<p>Now, plot, generate contours, and Kobs vs Ktheor</p>

<pre><code class="r">par(mfrow = c(5, 3), pin = c(1.75, 1.75), plt = c(0.0625, 0.9375, 0.0625, 0.9375))


plot(plot.1.pp[plot.1$genus == &quot;Tsuga&quot;])
plot(density(plot.1.pp[plot.1$genus == &quot;Tsuga&quot;]))
plot(envelope(plot.1.pp[plot.1$genus == &quot;Tsuga&quot;], Lest, global = FALSE))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  L[obs](r)
## theo   2   2 theo L[theo](r)
## hi     1   8   hi   L[hi](r)
## lo     1   8   lo   L[lo](r)
##                                                meaning
## obs            observed value of L(r) for data pattern
## theo                 theoretical value of L(r) for CSR
## hi   upper pointwise envelope of L(r) from simulations
## lo   lower pointwise envelope of L(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.1.pp[plot.1$genus == &quot;Betula&quot;])
plot(density(plot.1.pp[plot.1$genus == &quot;Betula&quot;]))
plot(envelope(plot.1.pp[plot.1$genus == &quot;Betula&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">

plot(plot.1.pp[plot.1$genus == &quot;Quercus&quot;])
plot(density(plot.1.pp[plot.1$genus == &quot;Quercus&quot;]))
plot(envelope(plot.1.pp[plot.1$genus == &quot;Quercus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.1.pp[plot.1$genus == &quot;Acer&quot;])
plot(density(plot.1.pp[plot.1$genus == &quot;Acer&quot;]))
plot(envelope(plot.1.pp[plot.1$genus == &quot;Acer&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">

plot(plot.1.pp[plot.1$genus == &quot;Pinus&quot;])
plot(density(plot.1.pp[plot.1$genus == &quot;Pinus&quot;]))
plot(envelope(plot.1.pp[plot.1$genus == &quot;Pinus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<p><img src="figure/unnamed-chunk-61.png" alt="plot of chunk unnamed-chunk-6"/> </p>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
par(mfrow = c(5, 3), pin = c(1.75, 1.75), plt = c(0.0625, 0.9375, 0.0625, 0.9375))
plot(plot.2.pp[plot.2$genus == &quot;Tsuga&quot;])
plot(density(plot.2.pp[plot.2$genus == &quot;Tsuga&quot;]))
plot(envelope(plot.2.pp[plot.2$genus == &quot;Tsuga&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.2.pp[plot.2$genus == &quot;Betula&quot;])
plot(density(plot.2.pp[plot.2$genus == &quot;Betula&quot;]))
plot(envelope(plot.2.pp[plot.2$genus == &quot;Betula&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.2.pp[plot.2$genus == &quot;Quercus&quot;])
plot(density(plot.2.pp[plot.2$genus == &quot;Quercus&quot;]))
plot(envelope(plot.2.pp[plot.2$genus == &quot;Quercus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.2.pp[plot.2$genus == &quot;Acer&quot;])
plot(density(plot.2.pp[plot.2$genus == &quot;Acer&quot;]))
plot(envelope(plot.2.pp[plot.2$genus == &quot;Acer&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.2.pp[plot.2$genus == &quot;Pinus&quot;])
plot(density(plot.2.pp[plot.2$genus == &quot;Pinus&quot;]))
plot(envelope(plot.2.pp[plot.2$genus == &quot;Pinus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<p><img src="figure/unnamed-chunk-62.png" alt="plot of chunk unnamed-chunk-6"/> </p>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
par(mfrow = c(5, 3), pin = c(1.75, 1.75), plt = c(0.0625, 0.9375, 0.0625, 0.9375))
plot(plot.3.pp[plot.3$genus == &quot;Tsuga&quot;])
plot(density(plot.3.pp[plot.3$genus == &quot;Tsuga&quot;]))
plot(envelope(plot.3.pp[plot.3$genus == &quot;Tsuga&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.3.pp[plot.3$genus == &quot;Betula&quot;])
plot(density(plot.3.pp[plot.3$genus == &quot;Betula&quot;]))
plot(envelope(plot.3.pp[plot.3$genus == &quot;Betula&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.3.pp[plot.3$genus == &quot;Quercus&quot;])
plot(density(plot.3.pp[plot.3$genus == &quot;Quercus&quot;]))
plot(envelope(plot.3.pp[plot.3$genus == &quot;Quercus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.3.pp[plot.3$genus == &quot;Acer&quot;])
plot(density(plot.3.pp[plot.3$genus == &quot;Acer&quot;]))
plot(envelope(plot.3.pp[plot.3$genus == &quot;Acer&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.3.pp[plot.3$genus == &quot;Pinus&quot;])
plot(density(plot.3.pp[plot.3$genus == &quot;Pinus&quot;]))
plot(envelope(plot.3.pp[plot.3$genus == &quot;Pinus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<p><img src="figure/unnamed-chunk-63.png" alt="plot of chunk unnamed-chunk-6"/> </p>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
par(mfrow = c(5, 3), pin = c(1.75, 1.75), plt = c(0.0625, 0.9375, 0.0625, 0.9375))
plot(plot.4.pp[plot.4$genus == &quot;Tsuga&quot;])
plot(density(plot.4.pp[plot.4$genus == &quot;Tsuga&quot;]))
plot(envelope(plot.4.pp[plot.4$genus == &quot;Tsuga&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.4.pp[plot.4$genus == &quot;Betula&quot;])
plot(density(plot.4.pp[plot.4$genus == &quot;Betula&quot;]))
plot(envelope(plot.4.pp[plot.4$genus == &quot;Betula&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.4.pp[plot.4$genus == &quot;Quercus&quot;])
plot(density(plot.4.pp[plot.4$genus == &quot;Quercus&quot;]))
plot(envelope(plot.4.pp[plot.4$genus == &quot;Quercus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.4.pp[plot.4$genus == &quot;Acer&quot;])
plot(density(plot.4.pp[plot.4$genus == &quot;Acer&quot;]))
plot(envelope(plot.4.pp[plot.4$genus == &quot;Acer&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.4.pp[plot.4$genus == &quot;Pinus&quot;])
plot(density(plot.4.pp[plot.4$genus == &quot;Pinus&quot;]))
plot(envelope(plot.4.pp[plot.4$genus == &quot;Pinus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<p><img src="figure/unnamed-chunk-64.png" alt="plot of chunk unnamed-chunk-6"/> </p>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.5.pp[plot.5$genus == &quot;Tsuga&quot;])
plot(density(plot.5.pp[plot.5$genus == &quot;Tsuga&quot;]))
plot(envelope(plot.5.pp[plot.5$genus == &quot;Tsuga&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.5.pp[plot.5$genus == &quot;Betula&quot;])
plot(density(plot.5.pp[plot.5$genus == &quot;Betula&quot;]))
plot(envelope(plot.5.pp[plot.5$genus == &quot;Betula&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.5.pp[plot.5$genus == &quot;Quercus&quot;])
plot(density(plot.5.pp[plot.5$genus == &quot;Quercus&quot;]))
plot(envelope(plot.5.pp[plot.5$genus == &quot;Quercus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.5.pp[plot.5$genus == &quot;Acer&quot;])
plot(density(plot.5.pp[plot.5$genus == &quot;Acer&quot;]))
plot(envelope(plot.5.pp[plot.5$genus == &quot;Acer&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.5.pp[plot.5$genus == &quot;Pinus&quot;])
plot(density(plot.5.pp[plot.5$genus == &quot;Pinus&quot;]))
plot(envelope(plot.5.pp[plot.5$genus == &quot;Pinus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<p><img src="figure/unnamed-chunk-65.png" alt="plot of chunk unnamed-chunk-6"/> </p>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">

plot(plot.6.pp[plot.6$genus == &quot;Tsuga&quot;])
plot(density(plot.6.pp[plot.6$genus == &quot;Tsuga&quot;]))
plot(envelope(plot.6.pp[plot.6$genus == &quot;Tsuga&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.6.pp[plot.6$genus == &quot;Betula&quot;])
plot(density(plot.6.pp[plot.6$genus == &quot;Betula&quot;]))
plot(envelope(plot.6.pp[plot.6$genus == &quot;Betula&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.6.pp[plot.6$genus == &quot;Quercus&quot;])
plot(density(plot.6.pp[plot.6$genus == &quot;Quercus&quot;]))
plot(envelope(plot.6.pp[plot.6$genus == &quot;Quercus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.6.pp[plot.6$genus == &quot;Acer&quot;])
plot(density(plot.6.pp[plot.6$genus == &quot;Acer&quot;]))
plot(envelope(plot.6.pp[plot.6$genus == &quot;Acer&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.6.pp[plot.6$genus == &quot;Pinus&quot;])
plot(density(plot.6.pp[plot.6$genus == &quot;Pinus&quot;]))
plot(envelope(plot.6.pp[plot.6$genus == &quot;Pinus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<p><img src="figure/unnamed-chunk-66.png" alt="plot of chunk unnamed-chunk-6"/> </p>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.7.pp[plot.7$genus == &quot;Tsuga&quot;])
plot(density(plot.7.pp[plot.7$genus == &quot;Tsuga&quot;]))
plot(envelope(plot.7.pp[plot.7$genus == &quot;Tsuga&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.7.pp[plot.7$genus == &quot;Betula&quot;])
plot(density(plot.7.pp[plot.7$genus == &quot;Betula&quot;]))
plot(envelope(plot.7.pp[plot.7$genus == &quot;Betula&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.7.pp[plot.7$genus == &quot;Quercus&quot;])
plot(density(plot.7.pp[plot.7$genus == &quot;Quercus&quot;]))
plot(envelope(plot.7.pp[plot.7$genus == &quot;Quercus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.7.pp[plot.7$genus == &quot;Acer&quot;])
plot(density(plot.7.pp[plot.7$genus == &quot;Acer&quot;]))
plot(envelope(plot.7.pp[plot.7$genus == &quot;Acer&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.7.pp[plot.7$genus == &quot;Pinus&quot;])
plot(density(plot.7.pp[plot.7$genus == &quot;Pinus&quot;]))
plot(envelope(plot.7.pp[plot.7$genus == &quot;Pinus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<p><img src="figure/unnamed-chunk-67.png" alt="plot of chunk unnamed-chunk-6"/> </p>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.8.pp[plot.8$genus == &quot;Tsuga&quot;])
plot(density(plot.8.pp[plot.8$genus == &quot;Tsuga&quot;]))
plot(envelope(plot.8.pp[plot.8$genus == &quot;Tsuga&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.8.pp[plot.8$genus == &quot;Betula&quot;])
plot(density(plot.8.pp[plot.8$genus == &quot;Betula&quot;]))
plot(envelope(plot.8.pp[plot.8$genus == &quot;Betula&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.8.pp[plot.8$genus == &quot;Quercus&quot;])
plot(density(plot.8.pp[plot.8$genus == &quot;Quercus&quot;]))
plot(envelope(plot.8.pp[plot.8$genus == &quot;Quercus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.8.pp[plot.8$genus == &quot;Acer&quot;])
plot(density(plot.8.pp[plot.8$genus == &quot;Acer&quot;]))
plot(envelope(plot.8.pp[plot.8$genus == &quot;Acer&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<pre><code class="r">
plot(plot.8.pp[plot.8$genus == &quot;Pinus&quot;])
plot(density(plot.8.pp[plot.8$genus == &quot;Pinus&quot;]))
plot(envelope(plot.8.pp[plot.8$genus == &quot;Pinus&quot;], Kest))
</code></pre>

<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
## 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
## 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,
## 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
## 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75,
## 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90,
## 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.
</code></pre>

<p><img src="figure/unnamed-chunk-68.png" alt="plot of chunk unnamed-chunk-6"/> </p>

<pre><code>##      lty col  key      label
## obs    1   1  obs  K[obs](r)
## theo   2   2 theo K[theo](r)
## hi     1   8   hi   K[hi](r)
## lo     1   8   lo   K[lo](r)
##                                                meaning
## obs            observed value of K(r) for data pattern
## theo                 theoretical value of K(r) for CSR
## hi   upper pointwise envelope of K(r) from simulations
## lo   lower pointwise envelope of K(r) from simulations
</code></pre>

<p>Next, run maximum absolute deviation tests of CSR on ppp data</p>

<pre><code class="r">
mad.test(plot.1.pp[plot.1$genus == &quot;Tsuga&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.1.pp[plot.1$genus == &quot;Tsuga&quot;]
## mad = 1.016, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.1.pp[plot.1$genus == &quot;Betula&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.1.pp[plot.1$genus == &quot;Betula&quot;]
## mad = 17, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.1.pp[plot.1$genus == &quot;Quercus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.1.pp[plot.1$genus == &quot;Quercus&quot;]
## mad = 5.256, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.1.pp[plot.1$genus == &quot;Acer&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.1.pp[plot.1$genus == &quot;Acer&quot;]
## mad = 6.744, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.1.pp[plot.1$genus == &quot;Pinus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.1.pp[plot.1$genus == &quot;Pinus&quot;]
## mad = 1.467, rank = 24, p-value = 0.24
</code></pre>

<pre><code class="r">
mad.test(plot.2.pp[plot.2$genus == &quot;Tsuga&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.2.pp[plot.2$genus == &quot;Tsuga&quot;]
## mad = 1.196, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.2.pp[plot.2$genus == &quot;Betula&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.2.pp[plot.2$genus == &quot;Betula&quot;]
## mad = 3.826, rank = 10, p-value = 0.1
</code></pre>

<pre><code class="r">mad.test(plot.2.pp[plot.2$genus == &quot;Quercus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.2.pp[plot.2$genus == &quot;Quercus&quot;]
## mad = 2.451, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.2.pp[plot.2$genus == &quot;Acer&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.2.pp[plot.2$genus == &quot;Acer&quot;]
## mad = 1.653, rank = 5, p-value = 0.05
</code></pre>

<pre><code class="r">mad.test(plot.2.pp[plot.2$genus == &quot;Pinus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.2.pp[plot.2$genus == &quot;Pinus&quot;]
## mad = 3.442, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">
mad.test(plot.3.pp[plot.3$genus == &quot;Tsuga&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.3.pp[plot.3$genus == &quot;Tsuga&quot;]
## mad = 1.032, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.3.pp[plot.3$genus == &quot;Betula&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.3.pp[plot.3$genus == &quot;Betula&quot;]
## mad = 3.301, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.3.pp[plot.3$genus == &quot;Quercus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.3.pp[plot.3$genus == &quot;Quercus&quot;]
## mad = 3.272, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.3.pp[plot.3$genus == &quot;Acer&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.3.pp[plot.3$genus == &quot;Acer&quot;]
## mad = 3.35, rank = 2, p-value = 0.02
</code></pre>

<pre><code class="r">mad.test(plot.3.pp[plot.3$genus == &quot;Pinus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.3.pp[plot.3$genus == &quot;Pinus&quot;]
## mad = 7.287, rank = 3, p-value = 0.03
</code></pre>

<pre><code class="r">
mad.test(plot.4.pp[plot.4$genus == &quot;Tsuga&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.4.pp[plot.4$genus == &quot;Tsuga&quot;]
## mad = 0.6014, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.4.pp[plot.4$genus == &quot;Betula&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.4.pp[plot.4$genus == &quot;Betula&quot;]
## mad = 2.95, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.4.pp[plot.4$genus == &quot;Quercus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.4.pp[plot.4$genus == &quot;Quercus&quot;]
## mad = 2.418, rank = 4, p-value = 0.04
</code></pre>

<pre><code class="r">mad.test(plot.4.pp[plot.4$genus == &quot;Acer&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.4.pp[plot.4$genus == &quot;Acer&quot;]
## mad = 3.07, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.4.pp[plot.4$genus == &quot;Pinus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.4.pp[plot.4$genus == &quot;Pinus&quot;]
## mad = 10.7, rank = 17, p-value = 0.17
</code></pre>

<pre><code class="r">
mad.test(plot.5.pp[plot.5$genus == &quot;Tsuga&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.5.pp[plot.5$genus == &quot;Tsuga&quot;]
## mad = 0.7566, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.5.pp[plot.5$genus == &quot;Betula&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.5.pp[plot.5$genus == &quot;Betula&quot;]
## mad = 2.039, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.5.pp[plot.5$genus == &quot;Quercus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.5.pp[plot.5$genus == &quot;Quercus&quot;]
## mad = 2.853, rank = 12, p-value = 0.12
</code></pre>

<pre><code class="r">mad.test(plot.5.pp[plot.5$genus == &quot;Acer&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.5.pp[plot.5$genus == &quot;Acer&quot;]
## mad = 1.97, rank = 3, p-value = 0.03
</code></pre>

<pre><code class="r">mad.test(plot.5.pp[plot.5$genus == &quot;Pinus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## Error: Some function values were infinite or NaN at distances r up to
## 22.5. Please specify a shorter &#39;rinterval&#39;
</code></pre>

<pre><code class="r">
mad.test(plot.6.pp[plot.6$genus == &quot;Tsuga&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.6.pp[plot.6$genus == &quot;Tsuga&quot;]
## mad = 1.098, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.6.pp[plot.6$genus == &quot;Betula&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.6.pp[plot.6$genus == &quot;Betula&quot;]
## mad = 3.468, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.6.pp[plot.6$genus == &quot;Quercus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.6.pp[plot.6$genus == &quot;Quercus&quot;]
## mad = 4.589, rank = 59, p-value = 0.59
</code></pre>

<pre><code class="r">mad.test(plot.6.pp[plot.6$genus == &quot;Acer&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.6.pp[plot.6$genus == &quot;Acer&quot;]
## mad = 3.882, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.6.pp[plot.6$genus == &quot;Pinus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.6.pp[plot.6$genus == &quot;Pinus&quot;]
## mad = 11.43, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">
mad.test(plot.7.pp[plot.7$genus == &quot;Tsuga&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.7.pp[plot.7$genus == &quot;Tsuga&quot;]
## mad = 10.23, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.7.pp[plot.7$genus == &quot;Betula&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.7.pp[plot.7$genus == &quot;Betula&quot;]
## mad = 4.043, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.7.pp[plot.7$genus == &quot;Quercus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.7.pp[plot.7$genus == &quot;Quercus&quot;]
## mad = 3.823, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.7.pp[plot.7$genus == &quot;Acer&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.7.pp[plot.7$genus == &quot;Acer&quot;]
## mad = 4.794, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.7.pp[plot.7$genus == &quot;Pinus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.7.pp[plot.7$genus == &quot;Pinus&quot;]
## mad = 2.411, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">
mad.test(plot.8.pp[plot.8$genus == &quot;Tsuga&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.8.pp[plot.8$genus == &quot;Tsuga&quot;]
## mad = 8.653, rank = 5, p-value = 0.05
</code></pre>

<pre><code class="r">mad.test(plot.8.pp[plot.8$genus == &quot;Betula&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.8.pp[plot.8$genus == &quot;Betula&quot;]
## mad = 1.542, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.8.pp[plot.8$genus == &quot;Quercus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.8.pp[plot.8$genus == &quot;Quercus&quot;]
## mad = 1.787, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.8.pp[plot.8$genus == &quot;Acer&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.8.pp[plot.8$genus == &quot;Acer&quot;]
## mad = 1.194, rank = 1, p-value = 0.01
</code></pre>

<pre><code class="r">mad.test(plot.8.pp[plot.8$genus == &quot;Pinus&quot;], Lest, verbose = FALSE, nsim = 99)
</code></pre>

<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: L(r)
##  Reference function: sample mean
##  Interval of distance values: [0, 22.5]
## 
## data:  plot.8.pp[plot.8$genus == &quot;Pinus&quot;]
## mad = 4.07, rank = 1, p-value = 0.01
</code></pre>

<p>Plot age x dbh, with smoother and marginal histograms - ms. Figure 8</p>

<pre><code class="r">
#### Extract tree ages, combine with species and dbh from trees

attach(dendro)

tree.sprout &lt;- by(dendro[, 6], INDICES = as.factor(dendro$TreeNum), min, simplify = FALSE)

tree.ids &lt;- by(dendro[, 1], INDICES = as.factor(dendro$TreeNum), mean, simplify = FALSE)

sprout &lt;- NULL
for (i in 1:length(tree.sprout)) sprout[i] &lt;- tree.sprout[[i]]

plotnum &lt;- NULL
for (i in 1:length(tree.ids)) plotnum[i] &lt;- tree.ids[[i]]

tree.ids &lt;- as.integer(names(tree.sprout))

tree.ages &lt;- cbind(tree.ids, sprout)

tree.age &lt;- 2003 - tree.ages[, 2]

tree.ages &lt;- cbind(tree.ages, tree.age)

tree.ages &lt;- as.data.frame(tree.ages)

tree.ages[, 4] &lt;- plotnum

names(tree.ages)[4] &lt;- &quot;plot&quot;


## deal with crashes from duplicate records at 27, 119, 230

for (i in 1:26) {
    tree.ages[i, 5] &lt;- trees$species[trees$tree == tree.ages$tree.ids[i]]
}
for (i in 28:117) {
    tree.ages[i, 5] &lt;- trees$species[trees$tree == tree.ages$tree.ids[i]]
}
for (i in 119:229) {
    tree.ages[i, 5] &lt;- trees$species[trees$tree == tree.ages$tree.ids[i]]
}

tree.ages[27, 5] &lt;- &quot;TSCA&quot;
tree.ages[118, 5] &lt;- &quot;PIST&quot;
tree.ages[230, 5] &lt;- &quot;TSCA&quot;

for (i in 1:26) {
    tree.ages[i, 6] &lt;- trees$dbh[trees$tree == tree.ages$tree.ids[i]]
}
for (i in 28:117) {
    tree.ages[i, 6] &lt;- trees$dbh[trees$tree == tree.ages$tree.ids[i]]
}
for (i in 119:229) {
    tree.ages[i, 6] &lt;- trees$dbh[trees$tree == tree.ages$tree.ids[i]]
}

tree.ages[27, 6] &lt;- 15
tree.ages[118, 6] &lt;- 62.5
tree.ages[230, 6] &lt;- 39.5

for (i in 1:26) {
    tree.ages[i, 7] &lt;- trees$genus[trees$tree == tree.ages$tree.ids[i]]
}
for (i in 28:117) {
    tree.ages[i, 7] &lt;- trees$genus[trees$tree == tree.ages$tree.ids[i]]
}
for (i in 119:229) {
    tree.ages[i, 7] &lt;- trees$genus[trees$tree == tree.ages$tree.ids[i]]
}

tree.ages[27, 7] &lt;- &quot;Tsuga&quot;
tree.ages[118, 7] &lt;- &quot;Pinus&quot;
tree.ages[230, 7] &lt;- &quot;Tsuga&quot;

tree.ages[, 8] &lt;- NA

tree.ages[, 8] &lt;- ifelse(tree.ages$plot &lt; 7, tree.ages[, 8] &lt;- &quot;hemlock&quot;, tree.ages[, 
    8] &lt;- &quot;hardwood&quot;)

tree.ages[, 9] &lt;- NA
tree.ages[, 9] &lt;- ifelse(tree.ages$plot &gt; 3 &amp; tree.ages$plot &lt; 8, tree.ages[, 
    9] &lt;- &quot;Ridge&quot;, tree.ages[, 9] &lt;- &quot;Valley&quot;)

detach(dendro)

names(tree.ages)[5:9] &lt;- c(&quot;species&quot;, &quot;dbh&quot;, &quot;genus&quot;, &quot;init.treat&quot;, &quot;block&quot;)


head(tree.ages)
</code></pre>

<pre><code>##   tree.ids sprout tree.age plot species  dbh  genus init.treat block
## 1        3   1961       42    4    TSCA  5.9  Tsuga    hemlock Ridge
## 2        5   1917       86    4    BELE 11.9 Betula    hemlock Ridge
## 3        9   1953       50    4    TSCA  8.3  Tsuga    hemlock Ridge
## 4       11   1927       76    4    ACRU 16.2   Acer    hemlock Ridge
## 5       21   1946       57    4    TSCA  6.4  Tsuga    hemlock Ridge
## 6       28   1937       66    4    TSCA 18.0  Tsuga    hemlock Ridge
</code></pre>

<p>Create the plot</p>

<pre><code class="r">
#original colors for all genera

genera.colors &lt;- c(&quot;firebrick4&quot;, &quot;coral&quot;, &quot;orange4&quot;, &quot;black&quot;, &quot;orange&quot;, 
        &quot;darkmagenta&quot;, &quot;darkolivegreen1&quot;, &quot;yellow&quot;, &quot;orange3&quot;, &quot;olivedrab3&quot;, 
            &quot;red&quot;, &quot;tan4&quot;, &quot;maroon4&quot;, &quot;darkgreen&quot;)

age.cols &lt;- genera.colors[c(1,2, 7,9, 10, 12, 14)]

for (i in 1:length(genera)) tree.ages[tree.ages$genus == genera[i],10] &lt;- genera.colors[i]
names(tree.ages)[10] &lt;- &quot;tree.color&quot;

tree.ages &lt;- drop.levels(tree.ages)
tree.ages$init.treat &lt;- as.factor(tree.ages$init.treat)
tree.ages$tree.color &lt;- as.factor(tree.ages$tree.color)
tree.ages$block &lt;- as.factor(tree.ages$block)


vh &lt;- tree.ages[tree.ages$block==&quot;Valley&quot; &amp; tree.ages$init.treat==&quot;hemlock&quot;,]
vd &lt;- tree.ages[tree.ages$block==&quot;Valley&quot; &amp; tree.ages$init.treat==&quot;hardwood&quot;,]
rh &lt;- tree.ages[tree.ages$block==&quot;Ridge&quot; &amp; tree.ages$init.treat==&quot;hemlock&quot;,]
rd &lt;- tree.ages[tree.ages$block==&quot;Ridge&quot; &amp; tree.ages$init.treat==&quot;hardwood&quot;,]


#histograms
#age distributions
hist.vh.age &lt;- hist(vh$tree.age[vh$genus==&quot;Tsuga&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.vh.bet.age&lt;- hist(vh$tree.age[vh$genus==&quot;Betula&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.vh.acer.age&lt;- hist(vh$tree.age[vh$genus==&quot;Acer&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.vh.quercus.age&lt;- hist(vh$tree.age[vh$genus==&quot;Quercus&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.vh.pinus.age&lt;- hist(vh$tree.age[vh$genus==&quot;Pinus&quot;], plot=FALSE, breaks=seq(10,150,10))

hist.rh.age &lt;- hist(rh$tree.age[rh$genus==&quot;Tsuga&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.rh.bet.age&lt;- hist(rh$tree.age[rh$genus==&quot;Betula&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.rh.acer.age&lt;- hist(rh$tree.age[rh$genus==&quot;Acer&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.rh.quercus.age&lt;- hist(rh$tree.age[rh$genus==&quot;Quercus&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.rh.pinus.age&lt;- hist(rh$tree.age[rh$genus==&quot;Pinus&quot;], plot=FALSE, breaks=seq(10,150,10))

hist.vd.age &lt;- hist(vd$tree.age[vd$genus==&quot;Tsuga&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.vd.bet.age&lt;- hist(vd$tree.age[vd$genus==&quot;Betula&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.vd.acer.age&lt;- hist(vd$tree.age[vd$genus==&quot;Acer&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.vd.quercus.age&lt;- hist(vd$tree.age[vd$genus==&quot;Quercus&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.vd.pinus.age&lt;- hist(vd$tree.age[vd$genus==&quot;Pinus&quot;], plot=FALSE, breaks=seq(10,150,10))

hist.rd.age &lt;- hist(rd$tree.age[rd$genus==&quot;Tsuga&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.rd.bet.age &lt;- hist(rd$tree.age[rd$genus==&quot;Betula&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.rd.acer.age &lt;- hist(rd$tree.age[rd$genus==&quot;Acer&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.rd.quercus.age&lt;- hist(rd$tree.age[rd$genus==&quot;Quercus&quot;], plot=FALSE, breaks=seq(10,150,10))
hist.rd.pinus.age&lt;- hist(rd$tree.age[rd$genus==&quot;Pinus&quot;], plot=FALSE, breaks=seq(10,150,10))

#dbh distributions

hist.vh.dbh &lt;- hist(vh$dbh[vh$genus==&quot;Tsuga&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.vh.bet.dbh &lt;- hist(vh$dbh[vh$genus==&quot;Betula&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.vh.acer.dbh &lt;- hist(vh$dbh[vh$genus==&quot;Acer&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.vh.quercus.dbh &lt;- hist(vh$dbh[vh$genus==&quot;Quercus&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.vh.pinus.dbh &lt;- hist(vh$dbh[vh$genus==&quot;Pinus&quot;], plot=FALSE, breaks=seq(0,80,10))

hist.rh.dbh &lt;- hist(rh$dbh[rh$genus==&quot;Tsuga&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.rh.bet.dbh &lt;- hist(rh$dbh[rh$genus==&quot;Betula&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.rh.acer.dbh &lt;- hist(rh$dbh[rh$genus==&quot;Acer&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.rh.quercus.dbh &lt;- hist(rh$dbh[rh$genus==&quot;Quercus&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.rh.pinus.dbh &lt;- hist(rh$dbh[rh$genus==&quot;Pinus&quot;], plot=FALSE, breaks=seq(0,80,10))


hist.vd.dbh &lt;- hist(vd$dbh[vd$genus==&quot;Tsuga&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.vd.bet.dbh &lt;- hist(vd$dbh[vd$genus==&quot;Betula&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.vd.acer.dbh &lt;- hist(vd$dbh[vd$genus==&quot;Acer&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.vd.quercus.dbh &lt;- hist(vd$dbh[vd$genus==&quot;Quercus&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.vd.pinus.dbh &lt;- hist(vd$dbh[vd$genus==&quot;Pinus&quot;], plot=FALSE, breaks=seq(0,80,10))

hist.rd.dbh &lt;- hist(rd$dbh[rd$genus==&quot;Tsuga&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.rd.bet.dbh &lt;- hist(rd$dbh[rd$genus==&quot;Betula&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.rd.acer.dbh &lt;- hist(rd$dbh[rd$genus==&quot;Acer&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.rd.quercus.dbh &lt;- hist(rd$dbh[rd$genus==&quot;Quercus&quot;], plot=FALSE, breaks=seq(0,80,10))
hist.rd.pinus.dbh &lt;- hist(rd$dbh[rd$genus==&quot;Pinus&quot;], plot=FALSE, breaks=seq(0,80,10))


vh.ages &lt;- rbind(hist.vh.age$counts, hist.vh.bet.age$counts, hist.vh.quercus.age$counts, 
        hist.vh.acer.age$counts, hist.vh.pinus.age$counts)
rh.ages &lt;- rbind(hist.rh.age$counts, hist.rh.bet.age$counts, hist.rh.quercus.age$counts, 
            hist.rh.acer.age$counts, hist.rh.pinus.age$counts)
vd.ages &lt;- rbind(hist.vd.age$counts, hist.vd.bet.age$counts, hist.vd.quercus.age$counts, 
            hist.vd.acer.age$counts, hist.vd.pinus.age$counts)
rd.ages &lt;- rbind(hist.rd.age$counts, hist.rd.bet.age$counts, hist.rd.quercus.age$counts, 
            hist.rd.acer.age$counts, hist.rd.pinus.age$counts)


vh.dbh &lt;- rbind(hist.vh.dbh$counts, hist.vh.bet.dbh$counts, hist.vh.quercus.dbh$counts, 
            hist.vh.acer.dbh$counts, hist.vh.pinus.dbh$counts)
rh.dbh &lt;- rbind(hist.rh.dbh$counts, hist.rh.bet.dbh$counts, hist.rh.quercus.dbh$counts, 
            hist.rh.acer.dbh$counts, hist.rh.pinus.dbh$counts)
vd.dbh &lt;- rbind(hist.vd.dbh$counts, hist.vd.bet.dbh$counts, hist.vd.quercus.dbh$counts, 
            hist.vd.acer.dbh$counts, hist.vd.pinus.dbh$counts)
rd.dbh &lt;- rbind(hist.rd.dbh$counts, hist.rd.bet.dbh$counts, hist.rd.quercus.dbh$counts, 
            hist.rd.acer.dbh$counts, hist.rd.pinus.dbh$counts)


#some plotting setup

five.colors &lt;-c(&quot;darkgreen&quot;,&quot;coral&quot;, &quot;tan4&quot;, &quot;firebrick4&quot;, &quot;olivedrab3&quot;) 
limits &lt;- list(xlims=c(10,150), ylims=c(0,80))
xpreds &lt;- seq(10,150,1)
xpreds.rev &lt;- sort(xpreds, decreasing=TRUE)

maxcount.ages &lt;- max(c(colSums(vh.ages), colSums(rh.ages), colSums(vd.ages), colSums(rd.ages) ) )
maxcount.dbh &lt;- max(c(colSums(vh.dbh), colSums(rh.dbh), colSums(vd.dbh), colSums(rd.dbh) ) )


#pdf(file=&quot;Figure 7 - age_dbh.pdf&quot;, width=6, height=6.5, colormodel=&quot;cmyk&quot;)

layout(matrix(c(0, 1, 2, 0, 3, 9, 10, 5, 4, 11, 12, 6, 0, 7, 8, 0), nrow=4, byrow=TRUE), heights=c(lcm(1.5), lcm(5.08), lcm(5.08), lcm(1.5)), widths=c(lcm(1.5), lcm(5.08), lcm(5.08), lcm(1.5)) ) 

#layout.show(12)


#barcharts

par(mar=c(0,1,0,1))
barplot(vh.ages, axes=FALSE, ylim=c(0,maxcount.ages), space=0, col=five.colors)
barplot(rh.ages, axes=FALSE, ylim=c(0,maxcount.ages), space=0, col=five.colors)
par(mar=c(1,0,.5,0))
barplot(vh.dbh, axes=FALSE, xlim=c(maxcount.dbh,0),  space=0, horiz=TRUE, col=five.colors)

mtext(&quot;DBH (cm)&quot;, side=2, line=.5, adj=-.5, font=2)

par(mar=c(.5,0,1,0))
barplot(vd.dbh, axes=FALSE, xlim=c(maxcount.dbh,0), space=0, horiz=TRUE, col=five.colors)
par(mar=c(1,0,.5,0))
barplot(rh.dbh, axes=FALSE, xlim=c(0,maxcount.dbh), space=0, horiz=TRUE, col=five.colors)
par(mar=c(.5,0,1,0))
barplot(rd.dbh, axes=FALSE, xlim=c(0,maxcount.dbh), space=0, horiz=TRUE, col=five.colors)
par(mar=c(0,1,0,1))
barplot(vd.ages, axes=FALSE, ylim=c(maxcount.ages,0), space=0, col=five.colors)
barplot(rd.ages, axes=FALSE, ylim=c(maxcount.ages,0), space=0, col=five.colors)

mtext(&quot;Age (years)&quot;, side=1, line=0, adj=-.5, font=2)


#scatterplots



par(mar=c(1,1,.5,1))
plot.vh &lt;- plot(vh$dbh ~ vh$tree.age, data=vh,
            xlim=limits$xlims, ylim=limits$ylims,                                   #axis ranges
            xlab= &quot;&quot;, ylab=&quot;&quot;, axes=FALSE, pch=19,                                  #misc
            col=as.character(vh$tree.color)                                     #colors     
    )
    axis(1, at=seq(15,145,10), labels=TRUE, tcl=-.25, lwd=2, font.axis=2, cex.axis=0.8, padj=-1.1, hadj=.5)
    axis(4, at=seq(5,75,10), labels=TRUE, tcl=-.25, lwd=2, font.axis=2, las=1, cex.axis=0.8, hadj= .5, padj=.25)
    axis(3, at=seq(15,145,10), labels=FALSE, tcl=-.25, lwd=2, font.axis=2)
    axis(2, at=seq(5,75,10), labels=FALSE, tcl=-.25, lwd=2, font.axis=2)
    box(lwd=2)

    vh.loess &lt;- loess(vh$dbh ~ vh$tree.age, span=1)                                         #add loess smooth + cis
    pred.vh &lt;- predict(vh.loess, xpreds, se=TRUE)
    lines(xpreds, pred.vh$fit, lty=&quot;solid&quot;, lwd=2, col=&quot;blue&quot;)
    y.poly.vh &lt;- c((pred.vh$fit+1.96*pred.vh$se.fit), (pred.vh$fit-1.96*pred.vh$se.fit)[order(xpreds, decreasing=TRUE)])
    x.poly.vh &lt;- c(xpreds, xpreds.rev)
    polygon(x.poly.vh[!is.na(y.poly.vh)], y.poly.vh[!is.na(y.poly.vh)], col=&quot;#00009933&quot;, border=NA)
    text(20,75,&quot;A&quot;, cex=1.5, font=2)

    text(15,2,&quot;1990&quot;, cex=0.8, font=2)
    text(145, 2, &quot;1860&quot;, cex=0.8, font=2)
    text(67, 2, &quot;1938&quot;, cex=0.8, font=2)

plot.rh &lt;- plot(rh$dbh ~ rh$tree.age, data=rh,
            xlim=limits$xlims, ylim=limits$ylims,                                   #axis ranges
            xlab= &quot;&quot;, ylab=&quot;&quot;, axes=FALSE, pch=19,                                  #misc
            col=as.character(rh$tree.color)                                     #colors     
    )
    axis(1, at=seq(15,145,10), labels=TRUE, tcl=-.25, lwd=2, font.axis=2, cex.axis=0.8, padj=-1.1, hadj=.5)
    axis(2, at=seq(5,75,10), labels=FALSE, tcl=-.25, lwd=2, font.axis=2)
    axis(3, at=seq(15,145,10), labels=FALSE, tcl=-.25, lwd=2, font.axis=2)
    axis(4, at=seq(5,75,10), labels=FALSE, tcl=-.25, lwd=2, font.axis=2)
    box(lwd=2)

    rh.loess &lt;- loess(rh$dbh ~ rh$tree.age, span=1)                                     #add loess smooth + cis
    pred.rh &lt;- predict(rh.loess, xpreds, se=TRUE)
    lines(xpreds, pred.rh$fit, lty=&quot;solid&quot;, lwd=2, col=&quot;blue&quot;)
    y.poly.rh &lt;- c((pred.rh$fit+1.96*pred.rh$se.fit), (pred.rh$fit-1.96*pred.rh$se.fit)[order(xpreds, decreasing=TRUE)])
    x.poly.rh &lt;- c(xpreds, xpreds.rev)
    polygon(x.poly.rh[!is.na(y.poly.rh)], y.poly.rh[!is.na(y.poly.rh)], col=&quot;#00009933&quot;, border=NA)
    text(20,75,&quot;B&quot;, cex=1.5, font=2)

    text(15,2,&quot;1990&quot;, cex=0.8, font=2)
    text(145, 2, &quot;1860&quot;, cex=0.8, font=2)
    text(67, 2, &quot;1938&quot;, cex=0.8, font=2)

par(mar=c(.5,1,1,1))
plot.vd &lt;- plot(vd$dbh ~ vd$tree.age, data=vd,
            xlim=limits$xlims, ylim=limits$ylims,                                   #axis ranges
            xlab= &quot;&quot;, ylab=&quot;&quot;, axes=FALSE, pch=19,                                  #misc
            col=as.character(vd$tree.color)                                     #colors     
    )
    axis(1, at=seq(15,145,10), labels=FALSE, tcl=-.25, lwd=2, font.axis=2)
    axis(4, at=seq(5,75,10), labels=TRUE, tcl=-.25, lwd=2, font.axis=2, cex.axis=0.8, las=1, hadj= .5, padj=.25)
    axis(3, at=seq(15,145,10), labels=FALSE, tcl=-.25, lwd=2, font.axis=2)
    axis(2, at=seq(5,75,10), labels=FALSE, tcl=-.25, lwd=2, font.axis=2)
    box(lwd=2)

    vd.loess &lt;- loess(vd$dbh ~ vd$tree.age, span=1)                                         #add loess smooth + cis
    pred.vd &lt;- predict(vd.loess, xpreds, se=TRUE)
    lines(xpreds, pred.vd$fit, lty=&quot;solid&quot;, lwd=2, col=&quot;blue&quot;)
    y.poly.vd &lt;- c((pred.vd$fit+1.96*pred.vd$se.fit), (pred.vd$fit-1.96*pred.vd$se.fit)[order(xpreds, decreasing=TRUE)])
    x.poly.vd &lt;- c(xpreds, xpreds.rev)
    polygon(x.poly.vd[!is.na(y.poly.vd)], y.poly.vd[!is.na(y.poly.vd)], col=&quot;#00009933&quot;, border=NA)
    text(20,75,&quot;C&quot;, cex=1.5, font=2)

    text(15,2,&quot;1990&quot;, cex=0.8, font=2)
    text(145, 2, &quot;1860&quot;, cex=0.8, font=2)
    text(67, 2, &quot;1938&quot;, cex=0.8, font=2)

plot.rd &lt;- plot(rd$dbh ~ rd$tree.age, data=rd,
            xlim=limits$xlims, ylim=limits$ylims,                                   #axis ranges
            xlab= &quot;&quot;, ylab=&quot;&quot;, axes=FALSE, pch=19,                                  #misc
            col=as.character(rd$tree.color)                                     #colors     
    )
    axis(1, at=seq(15,145,10), labels=FALSE, tcl=-.25, lwd=2, font.axis=2)
    axis(2, at=seq(5,75,10), labels=FALSE, tcl=-.25, lwd=2, font.axis=2)
    axis(3, at=seq(15,145,10), labels=FALSE, tcl=-.25, lwd=2, font.axis=2)
    axis(4, at=seq(5,75,10), labels=FALSE, tcl=-.25, lwd=2, font.axis=2)
    box(lwd=2)

    rd.loess &lt;- loess(rd$dbh ~ rd$tree.age, span=1)                                     #add loess smooth + cis
    pred.rd &lt;- predict(rd.loess, xpreds, se=TRUE)
    lines(xpreds, pred.rd$fit, lty=&quot;solid&quot;, lwd=2, col=&quot;blue&quot;)
    y.poly.rd &lt;- c((pred.rd$fit+1.96*pred.rd$se.fit), (pred.rd$fit-1.96*pred.rd$se.fit)[order(xpreds, decreasing=TRUE)])
    x.poly.rd &lt;- c(xpreds, xpreds.rev)
    polygon(x.poly.rd[!is.na(y.poly.rd)], y.poly.rd[!is.na(y.poly.rd)], col=&quot;#00009933&quot;, border=NA)
    text(20,75,&quot;D&quot;, cex=1.5, font=2)

    text(15,2,&quot;1990&quot;, cex=0.8, font=2)
    text(145, 2, &quot;1860&quot;, cex=0.8, font=2)
    text(67, 2, &quot;1938&quot;, cex=0.8, font=2)
</code></pre>

<p><img src="figure/unnamed-chunk-9.png" alt="plot of chunk unnamed-chunk-9"/> </p>

<pre><code class="r">
#dev.off()
</code></pre>

<p>Enviromental data - ms. Figure 7 now Figure 4</p>

<p>Read in data from a variety of sources:</p>

<p>Climate data: 
  Amherst, MA 1893-2012 (<a href="http://www.ncdc.noaa.gov/cdo.web">http://www.ncdc.noaa.gov/cdo.web</a>); 1896 is missing!!!</p>

<p>Harvard Forest 1964-2012 (2 files; Shaler 1964-2002 daily and Fisher 2001 to present monthly) (<a href="http://harvardforest.fas.harvard.edu/data-archive">http://harvardforest.fas.harvard.edu/data-archive</a>)</p>

<p>PDSI 481 - 2003 (<a href="http://www.ncdc.noaa.gov/paleo/pdsidata.html">http://www.ncdc.noaa.gov/paleo/pdsidata.html</a>)</p>

<p>population data from HF1980-13 and US Census bureau</p>

<p>Harvard Forest climate data</p>

<pre><code class="r">hf.Shaler &lt;- read.csv(&quot;C:/Users/aellison/Dropbox/Aaron&#39;s Briefcase/manuscript - Simes dendro and land use/env data/hf000-01-daily-m.csv&quot;, 
    header = TRUE)

head(hf.Shaler)
</code></pre>

<pre><code>##       Date AirT AirTmax AirTmin Prec
## 1 1/1/1964  -14      -6     -21  0.0
## 2 1/2/1964   -7       0     -14  6.4
## 3 1/3/1964   -2       1      -4  0.0
## 4 1/4/1964    2       6      -2  0.0
## 5 1/5/1964    0       4      -4  0.0
## 6 1/6/1964   -6       1     -12  0.0
</code></pre>

<pre><code class="r">summary(hf.Shaler)
</code></pre>

<pre><code>##        Date            AirT          AirTmax         AirTmin     
##  1/1/1964:    1   Min.   :-24.0   Min.   :-20.0   Min.   :-33.0  
##  1/1/1965:    1   1st Qu.: -1.0   1st Qu.:  4.0   1st Qu.: -6.0  
##  1/1/1966:    1   Median :  8.0   Median : 14.0   Median :  2.0  
##  1/1/1967:    1   Mean   :  7.3   Mean   : 13.1   Mean   :  1.5  
##  1/1/1968:    1   3rd Qu.: 16.0   3rd Qu.: 23.0   3rd Qu.: 10.0  
##  1/1/1969:    1   Max.   : 28.0   Max.   : 36.0   Max.   : 24.0  
##  (Other) :14055   NA&#39;s   :489     NA&#39;s   :288     NA&#39;s   :384    
##       Prec       
##  Min.   :  0.00  
##  1st Qu.:  0.00  
##  Median :  0.00  
##  Mean   :  3.01  
##  3rd Qu.:  1.50  
##  Max.   :119.40  
##  NA&#39;s   :148
</code></pre>

<pre><code class="r">str(hf.Shaler)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    14061 obs. of  5 variables:
##  $ Date   : Factor w/ 14061 levels &quot;1/1/1964&quot;,&quot;1/1/1965&quot;,..: 1 430 859 976 1015 1054 1093 1132 1171 40 ...
##  $ AirT   : int  -14 -7 -2 2 0 -6 -1 -5 -6 -4 ...
##  $ AirTmax: int  -6 0 1 6 4 1 4 3 -1 1 ...
##  $ AirTmin: int  -21 -14 -4 -2 -4 -12 -6 -12 -11 -9 ...
##  $ Prec   : num  0 6.4 0 0 0 0 0 0 10.2 0 ...
</code></pre>

<pre><code class="r">hf.Shaler$Date &lt;- as.character(hf.Shaler$Date)

a &lt;- as.Date(hf.Shaler$Date, &quot;%m/%d/%Y&quot;)

hf.Shaler &lt;- cbind(a, hf.Shaler)
names(hf.Shaler)[1] &lt;- &quot;date&quot;
head(hf.Shaler)
</code></pre>

<pre><code>##         date     Date AirT AirTmax AirTmin Prec
## 1 1964-01-01 1/1/1964  -14      -6     -21  0.0
## 2 1964-01-02 1/2/1964   -7       0     -14  6.4
## 3 1964-01-03 1/3/1964   -2       1      -4  0.0
## 4 1964-01-04 1/4/1964    2       6      -2  0.0
## 5 1964-01-05 1/5/1964    0       4      -4  0.0
## 6 1964-01-06 1/6/1964   -6       1     -12  0.0
</code></pre>

<pre><code class="r">str(hf.Shaler)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    14061 obs. of  6 variables:
##  $ date   : Date, format: &quot;1964-01-01&quot; &quot;1964-01-02&quot; ...
##  $ Date   : chr  &quot;1/1/1964&quot; &quot;1/2/1964&quot; &quot;1/3/1964&quot; &quot;1/4/1964&quot; ...
##  $ AirT   : int  -14 -7 -2 2 0 -6 -1 -5 -6 -4 ...
##  $ AirTmax: int  -6 0 1 6 4 1 4 3 -1 1 ...
##  $ AirTmin: int  -21 -14 -4 -2 -4 -12 -6 -12 -11 -9 ...
##  $ Prec   : num  0 6.4 0 0 0 0 0 0 10.2 0 ...
</code></pre>

<pre><code class="r">
hf.Fisher &lt;- read.csv(&quot;C:/Users/aellison/Dropbox/Aaron&#39;s Briefcase/manuscript - Simes dendro and land use/env data/hf001-02-annual-m.csv&quot;, 
    header = TRUE)

Fisher.2002 &lt;- hf.Fisher[1:2, c(2, 3, 4, 7)]
</code></pre>

<p>Take Fisher met data (1964 to mid-2002) and get mean temp values and total annual precip. Then, replace 2002 Fisher met data (incomplete) with Shaler met data for 2002; append 2003 data from Fisher</p>

<pre><code class="r">Shaler.temps &lt;- aggregate(hf.Shaler[, 3:5], list(year = cut(hf.Shaler$date, 
    &quot;years&quot;, right = TRUE)), mean, na.rm = TRUE)

Shaler.precip &lt;- aggregate(hf.Shaler[, 6], list(year = cut(hf.Shaler$date, &quot;years&quot;, 
    right = TRUE)), sum, na.rm = TRUE)

Shaler.annual &lt;- merge(Shaler.temps, Shaler.precip)
names(Shaler.annual)[5] &lt;- &quot;Precip&quot;

HF.annual &lt;- Shaler.annual
HF.annual$year &lt;- as.character(HF.annual$year)
HF.annual[39:40, 2:5] &lt;- Fisher.2002[, 1:4]
HF.annual[40, 1] &lt;- &quot;2003-01-01&quot;
HF.annual
</code></pre>

<pre><code>##          year  AirT AirTmax  AirTmin Precip
## 1  1964-01-01 7.050   13.32  0.78779  689.2
## 2  1965-01-01 7.269   13.17  0.95251  622.1
## 3  1966-01-01 6.857   13.11  0.61157  806.1
## 4  1967-01-01 6.319   12.11  0.57534 1119.7
## 5  1968-01-01 6.638   12.55  0.72981  883.7
## 6  1969-01-01 7.039   12.59  1.54270 1014.0
## 7  1970-01-01 6.371   12.13  0.68000  866.3
## 8  1971-01-01 6.888   12.66  1.15890  993.5
## 9  1972-01-01 6.449   11.56  1.25344 1266.1
## 10 1973-01-01 8.208   13.72  2.70083 1198.4
## 11 1974-01-01 6.964   12.58  1.39452 1082.6
## 12 1975-01-01 7.540   13.05  2.00000 1349.8
## 13 1976-01-01 6.598   12.31  0.96175 1113.6
## 14 1977-01-01 7.168   12.51  1.80495 1289.8
## 15 1978-01-01 6.562   12.29  0.81370  966.5
## 16 1979-01-01 7.808   13.03  2.50411 1424.5
## 17 1980-01-01 7.126   12.84  1.43169  859.0
## 18 1981-01-01 7.462   12.96  1.90659 1224.1
## 19 1982-01-01 6.995   12.82  1.15659 1111.6
## 20 1983-01-01 8.200   13.67  2.64932 1379.7
## 21 1984-01-01 7.885   13.27  2.41644 1282.5
## 22 1985-01-01 7.478   13.23  1.65746  944.2
## 23 1986-01-01 7.088   12.79  1.37260 1163.6
## 24 1987-01-01 7.556   13.42  1.67218 1003.1
## 25 1988-01-01 7.298   13.20  1.29670 1044.7
## 26 1989-01-01 7.482   13.08  1.81818 1309.0
## 27 1990-01-01 9.181   14.99  3.33973 1184.1
## 28 1991-01-01 8.796   14.75  2.86777 1380.6
## 29 1992-01-01 6.307   11.92  0.93036 1110.3
## 30 1993-01-01 7.387   13.65  0.79006 1277.4
## 31 1994-01-01 6.452   12.80 -0.07541 1227.3
## 32 1995-01-01 8.858   13.27  1.80080 1029.2
## 33 1996-01-01 7.558   12.85  1.65507 1379.8
## 34 1997-01-01 7.201   13.07  0.79630  907.1
## 35 1998-01-01 8.576   14.95  1.91395  954.4
## 36 1999-01-01 8.429   14.74  1.84150 1033.5
## 37 2000-01-01 6.909   12.69  1.16022 1080.1
## 38 2001-01-01 8.068   14.17  1.94366  808.2
## 39 2002-01-01 8.400   14.00  3.50000 1111.0
## 40 2003-01-01 7.400   12.80  2.40000 1310.0
</code></pre>

<p>Amherst climate data</p>

<pre><code class="r">amherst &lt;- read.csv(&quot;C:/Users/aellison/Dropbox/Aaron&#39;s Briefcase/manuscript - Simes dendro and land use/env data/Amherst_met_1893-2012-reduced.csv&quot;, 
    header = TRUE)

amherst$AirT &lt;- apply(amherst[, 10:11], 1, mean)
amherst.temps &lt;- aggregate(amherst[, c(10, 11, 25)], by = list(year = amherst$YEAR), 
    mean, na.rm = TRUE)

amherst.precip &lt;- aggregate(amherst[, 7], by = list(year = amherst$YEAR), sum, 
    na.rm = TRUE)

amherst.annual &lt;- merge(amherst.temps, amherst.precip)
names(amherst.annual)[2:5] &lt;- c(&quot;AirTmax&quot;, &quot;AirTmin&quot;, &quot;AirT&quot;, &quot;Precip&quot;)

# rescale to deg C and mm as ncdc data are in tenths
amherst.annual[, 2:5] &lt;- amherst.annual[, 2:5]/10

head(amherst.annual)
</code></pre>

<pre><code>##   year AirTmax AirTmin  AirT Precip
## 1 1893   13.38   1.610 7.507 1038.4
## 2 1894   14.73   2.934 8.818  791.1
## 3 1895   14.14   2.088 8.092 1031.1
## 4 1897   13.66   2.137 7.910 1259.7
## 5 1898   14.71   3.612 9.215 1285.9
## 6 1899   14.11   2.720 8.389 1056.9
</code></pre>

<pre><code class="r">
# need to add in missing year for 1896)
amherst.annual.fixed &lt;- amherst.annual
amherst.annual.fixed[5:121, ] &lt;- amherst.annual[4:120, ]
amherst.annual.fixed[4, ] &lt;- c(1896, NA, NA, NA, NA)
head(amherst.annual.fixed)
</code></pre>

<pre><code>##   year AirTmax AirTmin  AirT Precip
## 1 1893   13.38   1.610 7.507 1038.4
## 2 1894   14.73   2.934 8.818  791.1
## 3 1895   14.14   2.088 8.092 1031.1
## 4 1896      NA      NA    NA     NA
## 5 1897   13.66   2.137 7.910 1259.7
## 6 1898   14.71   3.612 9.215 1285.9
</code></pre>

<pre><code class="r">dim(amherst.annual.fixed)
</code></pre>

<pre><code>## [1] 121   5
</code></pre>

<pre><code class="r">
</code></pre>

<p>Palmer Drought Severity Index, station 267 (72.5 W, 42.5 N = near Leverett, MA. Data) from </p>

<pre><code class="r">leverett.pdsi &lt;- read.csv(&quot;C:/Users/aellison/Dropbox/Aaron&#39;s Briefcase/manuscript - Simes dendro and land use/env data/PDSO - 267.csv&quot;, 
    header = TRUE)

head(leverett.pdsi)
</code></pre>

<pre><code>##   YEAR NREC NCRN  RECON  X20LP  CRSQ  VRSQ    RE    CE  ACT X20LP.1
## 1  481    1    1 -1.737 -0.585 0.106 0.284 0.234 0.134 -100    -100
## 2  482    1    1  2.334 -0.631 0.106 0.284 0.234 0.134 -100    -100
## 3  483    1    1 -1.308 -0.684 0.106 0.284 0.234 0.134 -100    -100
## 4  484    1    1 -0.723 -0.732 0.106 0.284 0.234 0.134 -100    -100
## 5  485    1    1 -1.770 -0.761 0.106 0.284 0.234 0.134 -100    -100
## 6  486    1    1 -0.708 -0.763 0.106 0.284 0.234 0.134 -100    -100
</code></pre>

<pre><code class="r">summary(leverett.pdsi)
</code></pre>

<pre><code>##       YEAR           NREC             NCRN            RECON       
##  Min.   : 481   Min.   :-99.00   Min.   :-99.00   Min.   :-4.450  
##  1st Qu.: 862   1st Qu.:  1.00   1st Qu.:  1.00   1st Qu.:-1.258  
##  Median :1242   Median :  2.00   Median :  3.00   Median :-0.261  
##  Mean   :1242   Mean   :  2.53   Mean   :  7.16   Mean   :-0.192  
##  3rd Qu.:1622   3rd Qu.:  7.00   3rd Qu.:  9.00   3rd Qu.: 0.810  
##  Max.   :2003   Max.   :  7.00   Max.   : 29.00   Max.   : 4.070  
##      X20LP             CRSQ              VRSQ               RE         
##  Min.   :-1.893   Min.   :-100.00   Min.   :-100.00   Min.   :-100.00  
##  1st Qu.:-0.606   1st Qu.:   0.11   1st Qu.:   0.28   1st Qu.:   0.23  
##  Median :-0.178   Median :   0.20   Median :   0.31   Median :   0.26  
##  Mean   :-0.192   Mean   :  -1.41   Mean   :  -1.30   Mean   :  -1.33  
##  3rd Qu.: 0.182   3rd Qu.:   0.36   3rd Qu.:   0.42   3rd Qu.:   0.42  
##  Max.   : 1.427   Max.   :   0.43   Max.   :   0.44   Max.   :   0.43  
##        CE               ACT             X20LP.1       
##  Min.   :-100.00   Min.   :-100.00   Min.   :-100.00  
##  1st Qu.:   0.13   1st Qu.:-100.00   1st Qu.:-100.00  
##  Median :   0.16   Median :-100.00   Median :-100.00  
##  Mean   :  -1.39   Mean   : -93.17   Mean   : -93.17  
##  3rd Qu.:   0.40   3rd Qu.:-100.00   3rd Qu.:-100.00  
##  Max.   :   0.42   Max.   :   3.25   Max.   :   0.97
</code></pre>

<p>population data</p>

<pre><code class="r">pop.data &lt;- read.csv(&quot;C:/Users/aellison/Dropbox/Aaron&#39;s Briefcase/manuscript - Simes dendro and land use/env data/phampop.csv&quot;)
</code></pre>

<p>rework these into time-series objects and plot to check</p>

<pre><code class="r">HF.ts &lt;- ts(data = HF.annual[, 2:5], start = 1964, frequency = 1)
plot(HF.ts)
</code></pre>

<p><img src="figure/unnamed-chunk-151.png" alt="plot of chunk unnamed-chunk-15"/> </p>

<pre><code class="r">
Amherst.ts &lt;- ts(data = amherst.annual.fixed[-(1:4), 2:5], start = 1897, end = 2003, 
    frequency = 1)
plot(Amherst.ts)
</code></pre>

<p><img src="figure/unnamed-chunk-152.png" alt="plot of chunk unnamed-chunk-15"/> </p>

<pre><code class="r">

pdsi.ts &lt;- ts(data = leverett.pdsi$RECON, start = 481, frequency = 1)
plot(pdsi.ts, type = &quot;b&quot;, xlim = c(1875, 2003))
</code></pre>

<p><img src="figure/unnamed-chunk-153.png" alt="plot of chunk unnamed-chunk-15"/> </p>

<pre><code class="r">
pop.ts &lt;- ts(data = pop.data$popn, start = 1900, frequency = 0.1)
plot(pop.ts)
</code></pre>

<p><img src="figure/unnamed-chunk-154.png" alt="plot of chunk unnamed-chunk-15"/> </p>

<p>build a nice plot</p>

<pre><code class="r"># pdf(&#39;Simes_environment_v3.pdf&#39;, width=4, height=6, pointsize=8)
par(las = 1, mar = c(0, 0, 0, 1) + 0.1, fin = c(3.5, 4.6), yaxs = &quot;r&quot;)
ylimits &lt;- c(min(pdsi.ts) - 4.75, max(Amherst.ts[, 1]) + 22)
out.limits &lt;- ylimits * 1.04

plot(Amherst.ts[, 3], ylim = out.limits, xlim = c(1895, 2003), type = &quot;n&quot;, axes = FALSE, 
    xlab = &quot;&quot;, ylab = &quot;&quot;)

abline(h = -2, lty = 1, lwd = 1, col = &quot;gray&quot;)
# abline(v=1911, lty=2, lwd=1, col=&#39;black&#39;) Removed blight for rectangle
abline(v = 1938, lty = 2, lwd = 1, col = &quot;black&quot;)
abline(v = 1981, lty = 2, lwd = 1, col = &quot;black&quot;)
rect(1910, -11, 1915, 43, col = rgb(255, 192, 203, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #Chestnut blight
rect(1925, -11, 1932, 43, col = rgb(255, 192, 203, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #1925-32 logging
rect(1962, -11, 1966, 43, col = rgb(255, 192, 203, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #1960s drought
# abline(v=1918, lty=2, lwd=1, col=&#39;black&#39;) Removed WPBR


lines(pop.ts/100 + 27, lwd = 2, col = &quot;magenta4&quot;)

polygon(c(seq(1964, 2003, 1), seq(2003, 1964, -1)), c(HF.ts[, 3] + 15, rev(HF.ts[, 
    2] + 15)), col = rgb(0, 0, 255, alpha = 150, max = 255), lty = 0)

polygon(c(seq(1897, 2003, 1), seq(2003, 1897, -1)), c(Amherst.ts[, 1] + 15, 
    rev(Amherst.ts[, 2] + 15)), col = rgb(210, 210, 210, alpha = 200, max = 255), 
    lty = 0)

lines(rollapply(Amherst.ts[, 3], 10, mean) + 15, lty = 1, lwd = 2)
lines(Amherst.ts[, 3] + 15, lty = 1, lwd = 1)

lines(rollapply(HF.ts[, 1], 10, mean) + 15, lty = 1, lwd = 2, col = &quot;blue&quot;)
lines(HF.ts[, 1] + 15, col = &quot;blue&quot;, lty = 1, lwd = 1)

lines(rollapply(Amherst.ts[, 4]/100, 10, mean) - 1, lty = 1, lwd = 2, col = &quot;darkgoldenrod&quot;)
lines(Amherst.ts[, 4]/100 - 1, lwd = 1, col = &quot;darkgoldenrod&quot;)

lines(rollapply(HF.ts[, 4]/100, 10, mean) - 1, lty = 1, lwd = 2, col = &quot;darkgreen&quot;)
lines(HF.ts[, 4]/100 - 1, lwd = 1, col = &quot;darkgreen&quot;)

lines(rollapply(window(pdsi.ts, 1897, 2003), 5, mean) - 2, lty = 1, lwd = 2, 
    col = &quot;red&quot;)
lines(window(pdsi.ts, 1897, 2003) - 2, lty = 1, lwd = 1, col = &quot;red&quot;)




axis(1, tcl = -0.25, font = 1, padj = -1.5, cex.axis = 0.75)
axis(1, tcl = -0.125, at = seq(1895, 2005, 5), labels = FALSE)
axis(2, tcl = -0.25, at = seq(15, 30, 5), labels = c(&quot;  0&quot;, &quot;  5&quot;, &quot;10&quot;, &quot;15&quot;), 
    font = 1, hadj = 0.5, cex.axis = 0.75)
axis(2, tcl = -0.125, at = seq(15, 30, 1), labels = FALSE)

axis(4, tcl = -0.25, at = seq(33, 39, 3), labels = c(&quot; 600&quot;, &quot; 900&quot;, &quot;1200&quot;), 
    font = 1, cex.axis = 0.75, hadj = 0.25)
axis(4, tcl = -0.125, at = seq(33, 39, 1), labels = FALSE)

axis(4, tcl = -0.25, at = seq(5, 15, 5), labels = c(&quot;  600&quot;, &quot;1100&quot;, &quot;1600&quot;), 
    font = 1, cex.axis = 0.75, hadj = 0.25)
axis(4, tcl = -0.125, at = seq(5, 15, 1), labels = FALSE)

axis(2, tcl = -0.25, at = seq(-6, 2, 4), font = 1, labels = c(&quot;-4&quot;, &quot; 0&quot;, &quot; 4&quot;), 
    hadj = 0.5, cex.axis = 0.75)
axis(2, tcl = -0.125, at = seq(-6, 2, 1), labels = FALSE)

text(1892, 31, expression(bold(paste(degree, &quot;C&quot;))), pos = 4, cex = 0.75, font = 2)
text(1892, 3, &quot;PDSI&quot;, pos = 4, cex = 0.75, font = 2, col = &quot;red&quot;)
text(2008, 15, &quot;mm&quot;, pos = 2, cex = 0.75, font = 2, col = &quot;darkgreen&quot;)
text(2008, 40, &quot;Population&quot;, pos = 2, cex = 0.75, font = 2, col = &quot;magenta4&quot;)

mtext(side = 1, &quot;Year&quot;, padj = 2.5, cex = 0.85, font = 2)


arrows(x0 = 1938, y0 = -8, y1 = -11, lwd = 1, angle = 20, length = 0.1)
text(1937.5, -8.25, &quot;The Great&quot;, pos = 4, cex = 0.75)
text(1937.5, -9.5, &quot;Hurricane&quot;, pos = 4, cex = 0.75)
arrows(x0 = 1981, y0 = -8, y1 = -11, lwd = 1, angle = 20, length = 0.1)
text(1980.5, -8.25, &quot;Gypsy&quot;, pos = 4, cex = 0.75)
text(1980.5, -9.5, &quot;moth&quot;, pos = 4, cex = 0.75)

# segments(1925, -10, 1932, -10, lty=1, lwd=2)
text(1928.5, -8.875, &quot;Logging&quot;, cex = 0.75)

# arrows(x0=1911, y0=-8, y1=-11, lwd=1, angle=20, length=.1)
text(1912.5, -6.25, &quot;Drought&quot;, cex = 0.75)
text(1912.5, -7.25, &quot;and&quot;, cex = 0.65)
text(1912.5, -8.25, &quot;Chestnut&quot;, cex = 0.75)
text(1912.5, -9.5, &quot;blight&quot;, cex = 0.75)


text(1964, -8.875, &quot;Drought&quot;, cex = 0.75)
</code></pre>

<p><img src="figure/unnamed-chunk-16.png" alt="plot of chunk unnamed-chunk-16"/> </p>

<pre><code class="r"># dev.off()
</code></pre>

<p>Some analysis</p>

<pre><code class="r"># mean temps

apply(Amherst.ts, 2, mean)
</code></pre>

<pre><code>##  AirTmax  AirTmin     AirT   Precip 
##   14.991    2.815    8.901 1084.090
</code></pre>

<pre><code class="r">apply(HF.ts, 2, mean)
</code></pre>

<pre><code>##     AirT  AirTmax  AirTmin   Precip 
##    7.395   13.116    1.568 1095.010
</code></pre>

<pre><code class="r">
# average annual difference in temperatures
mean(window(Amherst.ts[, 3], start = 1964) - HF.ts[, 1])
</code></pre>

<pre><code>## [1] 1.687
</code></pre>

<pre><code class="r">mean(window(pdsi.ts, 1897, 2003))
</code></pre>

<pre><code>## [1] -0.09738
</code></pre>

<pre><code class="r">
# running means
plot(rollapply(HF.ts, 10, mean))
</code></pre>

<p><img src="figure/unnamed-chunk-171.png" alt="plot of chunk unnamed-chunk-17"/> </p>

<pre><code class="r">plot(rollapply(window(pdsi.ts, start = 1897, end = 2003), 10, mean))
</code></pre>

<p><img src="figure/unnamed-chunk-172.png" alt="plot of chunk unnamed-chunk-17"/> </p>

<pre><code class="r"># compare HF and Amherst data during period of overlap

cor.test(as.vector(window(Amherst.ts[, 3], start = 1964)), as.vector(HF.ts[, 
    1]))
</code></pre>

<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  as.vector(window(Amherst.ts[, 3], start = 1964)) and as.vector(HF.ts[, 1])
## t = 5.502, df = 38, p-value = 2.746e-06
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.4471 0.8095
## sample estimates:
##    cor 
## 0.6659
</code></pre>

<pre><code class="r">
lm(as.vector(HF.ts[, 1]) ~ as.vector(window(Amherst.ts[, 3], start = 1964)))
</code></pre>

<pre><code>## 
## Call:
## lm(formula = as.vector(HF.ts[, 1]) ~ as.vector(window(Amherst.ts[, 
##     3], start = 1964)))
## 
## Coefficients:
##                                      (Intercept)  
##                                            1.187  
## as.vector(window(Amherst.ts[, 3], start = 1964))  
##                                            0.684
</code></pre>

<pre><code class="r">
cor.test(as.vector(window(Amherst.ts[, 4], start = 1964)), as.vector(HF.ts[, 
    4]))
</code></pre>

<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  as.vector(window(Amherst.ts[, 4], start = 1964)) and as.vector(HF.ts[, 4])
## t = 8.8, df = 38, p-value = 1.052e-10
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.6814 0.9007
## sample estimates:
##   cor 
## 0.819
</code></pre>

<pre><code class="r">
lm(as.vector(HF.ts[, 4]) ~ as.vector(window(Amherst.ts[, 4], start = 1964)))
</code></pre>

<pre><code>## 
## Call:
## lm(formula = as.vector(HF.ts[, 4]) ~ as.vector(window(Amherst.ts[, 
##     4], start = 1964)))
## 
## Coefficients:
##                                      (Intercept)  
##                                          182.295  
## as.vector(window(Amherst.ts[, 4], start = 1964))  
##                                            0.824
</code></pre>

<p>Add age, radius, and BAI to dendro</p>

<pre><code class="r">den &lt;- dendro
Age &lt;- NULL
Radius &lt;- NULL
for (n in unique(den$TreeNum)) {
    hold &lt;- den[den$TreeNum == n, ]
    Age &lt;- c(Age, hold$Year - min(hold$Year))
    Radius &lt;- c(Radius, cumsum(hold$mmperyear))
}

BAI &lt;- (pi * Radius^2) - (pi * (Radius - den$mmperyear)^2)

gpyr &lt;- 1865 + (den$Year - 1861)%/%5 * 5

GenSpec &lt;- paste(den$Genus, den$Species)

den &lt;- data.frame(den, GenSpec, gpyr, Age, Radius, BAI)

birthyr.table &lt;- tapply(den$Year, list(den$TreeNum), min)
birthyr.TreeNum &lt;- as.numeric(names(birthyr.table))
birthyr.Year &lt;- as.integer(birthyr.table)
birthyr &lt;- data.frame(birthyr.TreeNum, birthyr.Year)
names(birthyr) &lt;- c(&quot;TreeNum&quot;, &quot;Byear&quot;)

for (n in unique(den$TreeNum)) {
    len &lt;- length(den[den$Treenum == n, 1])
    den$Byear[den$TreeNum == n] &lt;- rep(birthyr$Byear[birthyr$TreeNum == n], 
        len)
}

dendro.raw &lt;- den

# add blocks and canopy as factors, and level in correct order;

dendro.raw$block &lt;- ifelse(dendro.raw$Plot &gt; 3 &amp; dendro.raw$Plot &lt; 8, &quot;Ridge&quot;, 
    &quot;Valley&quot;)

dendro.raw$block &lt;- as.factor(dendro.raw$block)

dendro.raw$canopy &lt;- ifelse(dendro.raw$Plot &lt; 7, &quot;Hemlock&quot;, &quot;Hardwood&quot;)
dendro.raw$canopy &lt;- as.factor(dendro.raw$canopy)

dendro.raw$block &lt;- relevel(dendro.raw$block, ref = &quot;Valley&quot;)
dendro.raw$canopy &lt;- relevel(dendro.raw$canopy, ref = &quot;Hemlock&quot;)

dendro.raw$TreeNum &lt;- as.factor(dendro.raw$TreeNum)

head(dendro.raw)
</code></pre>

<pre><code>##   Plot Genus Species Code TreeNum Year mmperyear     GenSpec gpyr Age
## 1    1  Acer  rubrum ACRU     532 1935     1.275 Acer rubrum 1935   0
## 2    1  Acer  rubrum ACRU     532 1936     1.519 Acer rubrum 1940   1
## 3    1  Acer  rubrum ACRU     532 1937     1.375 Acer rubrum 1940   2
## 4    1  Acer  rubrum ACRU     532 1938     0.891 Acer rubrum 1940   3
## 5    1  Acer  rubrum ACRU     532 1939     0.737 Acer rubrum 1940   4
## 6    1  Acer  rubrum ACRU     532 1940     1.139 Acer rubrum 1940   5
##   Radius    BAI  block  canopy
## 1  1.275  5.107 Valley Hemlock
## 2  2.794 19.418 Valley Hemlock
## 3  4.169 30.078 Valley Hemlock
## 4  5.060 25.833 Valley Hemlock
## 5  5.797 25.138 Valley Hemlock
## 6  6.936 45.562 Valley Hemlock
</code></pre>

<pre><code class="r">dim(dendro.raw)
</code></pre>

<pre><code>## [1] 17199    14
</code></pre>

<pre><code class="r">str(dendro.raw)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    17199 obs. of  14 variables:
##  $ Plot     : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ Genus    : Factor w/ 7 levels &quot;Acer&quot;,&quot;Betula&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Species  : Factor w/ 13 levels &quot;alba&quot;,&quot;allegheniensis&quot;,..: 9 9 9 9 9 9 9 9 9 9 ...
##  $ Code     : Factor w/ 12 levels &quot;ACRU&quot;,&quot;ACSA&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ TreeNum  : Factor w/ 230 levels &quot;3&quot;,&quot;5&quot;,&quot;9&quot;,&quot;11&quot;,..: 158 158 158 158 158 158 158 158 158 158 ...
##  $ Year     : int  1935 1936 1937 1938 1939 1940 1941 1942 1943 1944 ...
##  $ mmperyear: num  1.275 1.519 1.375 0.891 0.737 ...
##  $ GenSpec  : Factor w/ 13 levels &quot;Acer rubrum&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ gpyr     : num  1935 1940 1940 1940 1940 ...
##  $ Age      : int  0 1 2 3 4 5 6 7 8 9 ...
##  $ Radius   : num  1.27 2.79 4.17 5.06 5.8 ...
##  $ BAI      : num  5.11 19.42 30.08 25.83 25.14 ...
##  $ block    : Factor w/ 2 levels &quot;Valley&quot;,&quot;Ridge&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ canopy   : Factor w/ 2 levels &quot;Hemlock&quot;,&quot;Hardwood&quot;: 1 1 1 1 1 1 1 1 1 1 ...
</code></pre>

<p>Reduce to 5 key species; reorder factors:</p>

<pre><code class="r">dendro.5sp &lt;- dendro.raw[dendro.raw$Code == &quot;TSCA&quot; | dendro.raw$Code == &quot;ACRU&quot; | 
    dendro.raw$Code == &quot;BELE&quot; | dendro.raw$Code == &quot;QURU&quot; | dendro.raw$Code == 
    &quot;PIST&quot;, ]

dendro.5sp &lt;- droplevels(dendro.5sp)
dendro.5sp$Code &lt;- reorder(dendro.5sp$Code, new.order = c(5, 2, 4, 1, 3))
dendro.5sp$Code &lt;- factor(dendro.5sp$Code, labels = c(&quot;Tsuga&quot;, &quot;Betula&quot;, &quot;Quercus&quot;, 
    &quot;Acer&quot;, &quot;Pinus&quot;))

# relative BAI

dendro.5sp$rBAI &lt;- ((pi * dendro.5sp$Radius^2) - pi * (dendro.5sp$Radius - dendro.5sp$mmperyear)^2)/(dendro.5sp$Radius - 
    dendro.5sp$mmperyear)

dendro.5sp$rBAI[dendro.5sp$rBAI == Inf] &lt;- NA

# pad the few 0s for log plotting

dendro.5sp$rBAI[dendro.5sp$rBAI == 0] &lt;- 1e-04

head(dendro.5sp)
</code></pre>

<pre><code>##   Plot Genus Species Code TreeNum Year mmperyear     GenSpec gpyr Age
## 1    1  Acer  rubrum Acer     532 1935     1.275 Acer rubrum 1935   0
## 2    1  Acer  rubrum Acer     532 1936     1.519 Acer rubrum 1940   1
## 3    1  Acer  rubrum Acer     532 1937     1.375 Acer rubrum 1940   2
## 4    1  Acer  rubrum Acer     532 1938     0.891 Acer rubrum 1940   3
## 5    1  Acer  rubrum Acer     532 1939     0.737 Acer rubrum 1940   4
## 6    1  Acer  rubrum Acer     532 1940     1.139 Acer rubrum 1940   5
##   Radius    BAI  block  canopy   rBAI
## 1  1.275  5.107 Valley Hemlock     NA
## 2  2.794 19.418 Valley Hemlock 15.229
## 3  4.169 30.078 Valley Hemlock 10.765
## 4  5.060 25.833 Valley Hemlock  6.197
## 5  5.797 25.138 Valley Hemlock  4.968
## 6  6.936 45.562 Valley Hemlock  7.860
</code></pre>

<pre><code class="r">str(dendro.5sp)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    15919 obs. of  15 variables:
##  $ Plot     : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ Genus    : Factor w/ 5 levels &quot;Acer&quot;,&quot;Betula&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Species  : Factor w/ 6 levels &quot;canadensis&quot;,&quot;candensis&quot;,..: 5 5 5 5 5 5 5 5 5 5 ...
##  $ Code     : Factor w/ 5 levels &quot;Tsuga&quot;,&quot;Betula&quot;,..: 4 4 4 4 4 4 4 4 4 4 ...
##  $ TreeNum  : Factor w/ 212 levels &quot;3&quot;,&quot;5&quot;,&quot;9&quot;,&quot;11&quot;,..: 145 145 145 145 145 145 145 145 145 145 ...
##  $ Year     : int  1935 1936 1937 1938 1939 1940 1941 1942 1943 1944 ...
##  $ mmperyear: num  1.275 1.519 1.375 0.891 0.737 ...
##  $ GenSpec  : Factor w/ 6 levels &quot;Acer rubrum&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ gpyr     : num  1935 1940 1940 1940 1940 ...
##  $ Age      : int  0 1 2 3 4 5 6 7 8 9 ...
##  $ Radius   : num  1.27 2.79 4.17 5.06 5.8 ...
##  $ BAI      : num  5.11 19.42 30.08 25.83 25.14 ...
##  $ block    : Factor w/ 2 levels &quot;Valley&quot;,&quot;Ridge&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ canopy   : Factor w/ 2 levels &quot;Hemlock&quot;,&quot;Hardwood&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ rBAI     : num  NA 15.23 10.77 6.2 4.97 ...
</code></pre>

<p>Plots</p>

<p>Figure 9: Individual traces of rBAI as a function of year, with smoothers. Overlay hemlock and hardwood plots.</p>

<pre><code class="r"># To create pdf, uncomment pdf and dev.off() lines.
# pdf(&#39;Figure-9-BAI-both-v2.pdf&#39;, width=4, height=6)

ggplot(data = dendro.5sp[dendro.5sp$canopy == &quot;Hemlock&quot;, ], aes(x = Year, y = rBAI, 
    group = TreeNum)) + facet_grid(Code ~ block) + scale_y_log10(limits = c(0.1, 
    100), breaks = c(1, 10, 100)) + scale_x_continuous(limits = c(1860, 2005), 
    breaks = c(seq(1880, 2000, 40))) + 
# add environmental markers

geom_rect(xmin = 1910, xmax = 1915, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
    alpha = 0.3, inherit.aes = FALSE) + geom_rect(xmin = 1925, xmax = 1932, 
    ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, alpha = 0.3, inherit.aes = FALSE) + 
    geom_rect(xmin = 1962, xmax = 1966, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
        alpha = 0.3, inherit.aes = FALSE) + 
# geom_vline(xintercept=1911, color=&#39;grey50&#39;, linetype=2, size=.25) +
# geom_vline(xintercept=1918, color=&#39;grey50&#39;, linetype=2, size=.25) +
geom_vline(xintercept = 1938, color = &quot;grey50&quot;, linetype = 2, size = 0.25) + 
    geom_vline(xintercept = 1981, color = &quot;grey50&quot;, linetype = 2, size = 0.25) + 

geom_line(colour = &quot;grey&quot;, size = 0.25) + 
# add the hardwood plots in light blue

geom_line(data = dendro.5sp[dendro.5sp$canopy == &quot;Hardwood&quot;, ], aes(x = Year, 
    y = rBAI, group = TreeNum), colour = &quot;lightblue&quot;, size = 0.25) + 
# smoothers go next

# geom_smooth(se=FALSE, data=dendro.5sp[dendro.5sp$canopy==&#39;Hemlock&#39;,],
# aes(group=1), method=&#39;loess&#39;, na.action=na.omit, span=.1, linetype=1,
# colour=&#39;black&#39;, weight=2) +

# geom_smooth(se=FALSE, data=dendro.5sp[dendro.5sp$canopy==&#39;Hardwood&#39;,],
# aes(group=1), method=&#39;loess&#39;, na.action=na.omit, span=.1, linetype=1,
# colour=&#39;blue&#39;, weight=2) +

stat_smooth(se = FALSE, data = dendro.5sp[dendro.5sp$canopy == &quot;Hemlock&quot;, ], 
    aes(group = 1), method = &quot;loess&quot;, degree = 0, na.action = na.omit, span = 0.1, 
    linetype = 1, colour = &quot;black&quot;, weight = 2) + 

stat_smooth(se = FALSE, data = dendro.5sp[dendro.5sp$canopy == &quot;Hardwood&quot;, ], 
    aes(group = 1), method = &quot;loess&quot;, degree = 0, na.action = na.omit, span = 0.1, 
    linetype = 1, colour = &quot;blue&quot;, weight = 2) + 
theme_bw() + theme(strip.text.y = element_text(face = &quot;italic&quot;, size = 8), strip.text.x = element_text(size = 8), 
    axis.text = element_text(size = 7), axis.title = element_text(size = 10), 
    axis.ticks.length = unit(1, &quot;mm&quot;), axis.ticks = element_line(size = 0.25)) + 
    # ylab(expression(paste(&#39;Relative change in basal area (&#39; mm^2 cdot mm^)
ylab(expression(paste(&quot;Relative change in basal area (&quot;, mm^2 %.% mm^-2 %.% 
    yr^-1, &quot;)&quot;)))
</code></pre>

<pre><code>## Warning: Removed 59 rows containing missing values (stat_smooth).
## Warning: Removed 61 rows containing missing values (stat_smooth).
## Warning: Removed 1 rows containing missing values (stat_smooth).
## Warning: Removed 10 rows containing missing values (stat_smooth).
## Warning: Removed 8 rows containing missing values (stat_smooth).
## Warning: Removed 3 rows containing missing values (stat_smooth).
## Warning: Removed 7 rows containing missing values (stat_smooth).
## Warning: Removed 8 rows containing missing values (stat_smooth).
## Warning: Removed 7 rows containing missing values (stat_smooth).
## Warning: Removed 2 rows containing missing values (stat_smooth).
## Warning: Removed 3 rows containing missing values (stat_smooth).
## Warning: Removed 11 rows containing missing values (stat_smooth).
## Warning: Removed 9 rows containing missing values (stat_smooth).
## Warning: Removed 4 rows containing missing values (stat_smooth).
## Warning: Removed 2 rows containing missing values (stat_smooth).
## Warning: Removed 11 rows containing missing values (stat_smooth).
## Warning: Removed 6 rows containing missing values (stat_smooth).
## Warning: Removed 7 rows containing missing values (stat_smooth).
## Warning: Removed 57 rows containing missing values (geom_path).
## Warning: Removed 61 rows containing missing values (geom_path).
## Warning: Removed 1 rows containing missing values (geom_path).
## Warning: Removed 10 rows containing missing values (geom_path).
## Warning: Removed 8 rows containing missing values (geom_path).
## Warning: Removed 3 rows containing missing values (geom_path).
## Warning: Removed 7 rows containing missing values (geom_path).
## Warning: Removed 8 rows containing missing values (geom_path).
## Warning: Removed 5 rows containing missing values (geom_path).
## Warning: Removed 2 rows containing missing values (geom_path).
## Warning: Removed 3 rows containing missing values (geom_path).
## Warning: Removed 11 rows containing missing values (geom_path).
## Warning: Removed 9 rows containing missing values (geom_path).
## Warning: Removed 4 rows containing missing values (geom_path).
## Warning: Removed 2 rows containing missing values (geom_path).
## Warning: Removed 11 rows containing missing values (geom_path).
## Warning: Removed 6 rows containing missing values (geom_path).
## Warning: Removed 7 rows containing missing values (geom_path).
</code></pre>

<p><img src="figure/unnamed-chunk-21.png" alt="plot of chunk unnamed-chunk-21"/> </p>

<pre><code class="r">
# dev.off()
</code></pre>

<p>Fit 1-d GAMs</p>

<pre><code class="r">
gam.acer1 &lt;- gam(rBAI ~ as.factor(Year) + s(Age, fx = TRUE, k = 4, bs = &quot;cs&quot;), 
    data = subset(dendro.5sp, Code == &quot;Acer&quot;))
gam.betula1 &lt;- gam(rBAI ~ as.factor(Year) + s(Age, fx = TRUE, k = 4, bs = &quot;cs&quot;), 
    data = subset(dendro.5sp, Code == &quot;Betula&quot;))
gam.quercus1 &lt;- gam(rBAI ~ as.factor(Year) + s(Age, fx = TRUE, k = 4, bs = &quot;cs&quot;), 
    data = subset(dendro.5sp, Code == &quot;Quercus&quot;))
gam.pinus1 &lt;- gam(rBAI ~ as.factor(Year) + s(Age, fx = TRUE, k = 4, bs = &quot;cs&quot;), 
    data = subset(dendro.5sp, Code == &quot;Pinus&quot;))
gam.tsuga1 &lt;- gam(rBAI ~ as.factor(Year) + s(Age, fx = TRUE, k = 4, bs = &quot;cs&quot;), 
    data = subset(dendro.5sp, Code == &quot;Tsuga&quot;))


# get wiggly year effects


years.a &lt;- c(min(dendro.5sp$Year[dendro.5sp$Code == &quot;Acer&quot;]):2004)
lastyr.a &lt;- 2005 - min(dendro.5sp$Year[dendro.5sp$Code == &quot;Acer&quot; &amp; dendro.5sp$Age == 
    0])
fixed.year.a &lt;- c(gam.acer1$coef[1], gam.acer1$coef[1] + gam.acer1$coef[2:lastyr.a])


years.b &lt;- c(min(dendro.5sp$Year[dendro.5sp$Code == &quot;Betula&quot;]):2004)
lastyr.b &lt;- 2005 - min(dendro.5sp$Year[dendro.5sp$Code == &quot;Betula&quot; &amp; dendro.5sp$Age == 
    0])
fixed.year.b &lt;- c(gam.betula1$coef[1], gam.betula1$coef[1] + gam.betula1$coef[2:lastyr.b])

years.q &lt;- c(min(dendro.5sp$Year[dendro.5sp$Code == &quot;Quercus&quot;]):2004)
lastyr.q &lt;- 2005 - min(dendro.5sp$Year[dendro.5sp$Code == &quot;Quercus&quot; &amp; dendro.5sp$Age == 
    0])
fixed.year.q &lt;- c(gam.quercus1$coef[1], gam.quercus1$coef[1] + gam.quercus1$coef[2:lastyr.q])

years.p &lt;- c(min(dendro.5sp$Year[dendro.5sp$Code == &quot;Pinus&quot;]):2004)
lastyr.p &lt;- 2005 - min(dendro.5sp$Year[dendro.5sp$Code == &quot;Pinus&quot; &amp; dendro.5sp$Age == 
    0])
fixed.year.p &lt;- c(gam.pinus1$coef[1], gam.pinus1$coef[1] + gam.pinus1$coef[2:lastyr.p])

years.t &lt;- c(min(dendro.5sp$Year[dendro.5sp$Code == &quot;Tsuga&quot;]):2004)
lastyr.t &lt;- 2005 - min(dendro.5sp$Year[dendro.5sp$Code == &quot;Tsuga&quot; &amp; dendro.5sp$Age == 
    0])
fixed.year.t &lt;- c(gam.tsuga1$coef[1], gam.tsuga1$coef[1] + gam.tsuga1$coef[2:lastyr.t])

</code></pre>

<p>Nice 10-panel plot per Rhodora specs</p>

<pre><code class="r">
# gam plots in first column remove comments on pdf() and dev.off() to
# generate pdf

# pdf(&#39;Figure_10-single-gams-v2.pdf&#39;, height=7, width=5, pointsize=9)

layout(matrix(c(1:10), 5, 2, byrow = FALSE), widths = rep(lcm(5), 2), heights = rep(lcm(3), 
    5))
# layout.show(10)
par(mar = c(1, 2, 0, 0.5))
plot(gam.tsuga1, se = TRUE, xlab = &quot;&quot;, ylab = &quot;&quot;, xlim = c(0, 140), rug = FALSE, 
    tcl = -0.25, col.axis = &quot;white&quot;)
axis(2, las = 1, tcl = -0.25, at = c(-2, 0, 2))
text(0, -2, &quot;Tsuga&quot;, font = 3, pos = 4)
mtext(side = 3, &quot;s(Age)&quot;, adj = 0, line = 0.5, cex = 1)


plot(gam.betula1, se = TRUE, xlab = &quot;&quot;, ylab = &quot;&quot;, xlim = c(0, 140), rug = FALSE, 
    tcl = -0.25, col.axis = &quot;white&quot;)
axis(2, las = 1, tcl = -0.25, at = seq(-10, 5, 5))
text(0, -10, &quot;Betula&quot;, font = 3, pos = 4)

plot(gam.quercus1, se = TRUE, xlab = &quot;&quot;, ylab = &quot;&quot;, xlim = c(0, 140), rug = FALSE, 
    tcl = -0.25, col.axis = &quot;white&quot;)
axis(2, las = 1, tcl = -0.25, at = seq(-20, 10, 10))
text(0, -20, &quot;Quercus&quot;, font = 3, pos = 4)

plot(gam.acer1, se = TRUE, xlab = &quot;&quot;, ylab = &quot;&quot;, xlim = c(0, 140), rug = FALSE, 
    tcl = -0.25, col.axis = &quot;white&quot;)
axis(2, las = 1, tcl = -0.25, at = seq(-10, 5, 5))
text(0, -10, &quot;Acer&quot;, font = 3, pos = 4)

plot(gam.pinus1, se = TRUE, xlab = &quot;Age&quot;, ylab = &quot;&quot;, xlim = c(0, 140), rug = FALSE, 
    tcl = -0.25, col.axis = &quot;white&quot;)
axis(2, las = 1, tcl = -0.25, at = seq(-25, 5, 15))
axis(1, tcl = -0.25, padj = -0.5)
text(0, -23, &quot;Pinus&quot;, font = 3, pos = 4)
mtext(side = 1, &quot;Age&quot;, , line = 2.25, cex = 1)


# age wiggles in 2nd column

par(mar = c(1, 0.5, 0, 2))
plot(years.t, fixed.year.t, type = &quot;n&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, xlim = c(1860, 
    2005), col.axis = &quot;white&quot;, tcl = 0)
abline(v = c(1938, 1981), lty = 2, col = &quot;grey&quot;)
rect(1910, -11, 1915, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #Chestnut blight
rect(1925, -11, 1932, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #1925-32 logging
rect(1962, -11, 1966, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #1960s drought
lines(years.t, fixed.year.t)
axis(1, tcl = -0.25, at = seq(1860, 2000, 20), labels = FALSE)
axis(4, tcl = -0.25, at = seq(0, 20, 10), las = 1)
mtext(side = 3, &quot;f(Year)&quot;, adj = 1, line = 0.5, cex = 1)
box()


plot(years.b, fixed.year.b, type = &quot;n&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, xlim = c(1860, 
    2005), col.axis = &quot;white&quot;, tcl = 0)
abline(v = c(1938, 1981), lty = 2, col = &quot;grey&quot;)
rect(1910, -11, 1915, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #Chestnut blight
rect(1925, -11, 1932, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #1925-32 logging
rect(1962, -11, 1966, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #1960s drought
lines(years.b, fixed.year.b)
axis(1, tcl = -0.25, at = seq(1860, 2000, 20), labels = FALSE)
axis(4, tcl = -0.25, at = seq(0, 20, 10), las = 1)
box()


plot(years.q, fixed.year.q, type = &quot;n&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, xlim = c(1860, 
    2005), col.axis = &quot;white&quot;, tcl = 0)
abline(v = c(1938, 1981), lty = 2, col = &quot;grey&quot;)
rect(1910, -11, 1915, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #Chestnut blight
rect(1925, -11, 1932, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #1925-32 logging
rect(1962, -11, 1966, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #1960s drought
lines(years.q, fixed.year.q)
axis(1, tcl = -0.25, at = seq(1860, 2000, 20), labels = FALSE)
axis(4, tcl = -0.25, at = seq(5, 15, 5), las = 1)
box()

plot(years.a, fixed.year.a, type = &quot;n&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, xlim = c(1860, 
    2005), col.axis = &quot;white&quot;, tcl = 0)
abline(v = c(1938, 1981), lty = 2, col = &quot;grey&quot;)
rect(1910, -11, 1915, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #Chestnut blight
rect(1925, -11, 1932, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #1925-32 logging
rect(1962, -11, 1966, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #1960s drought
lines(years.a, fixed.year.a)
axis(1, tcl = -0.25, at = seq(1860, 2000, 20), labels = FALSE)
axis(4, tcl = -0.25, at = seq(0, 20, 10), las = 1)
box()


plot(years.p, fixed.year.p, type = &quot;n&quot;, xlab = &quot;&quot;, ylab = &quot;&quot;, xlim = c(1860, 
    2005), col.axis = &quot;white&quot;, tcl = 0)
abline(v = c(1938, 1981), lty = 2, col = &quot;grey&quot;)
rect(1910, -11, 1915, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #Chestnut blight
rect(1925, -11, 1932, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #1925-32 logging
rect(1962, -11, 1966, 43, col = rgb(190, 190, 190, alpha = 75, max = 255), lty = 0, 
    lwd = 0)  #1960s drought
lines(years.p, fixed.year.p)
axis(1, tcl = -0.25, at = seq(1860, 2000, 20), labels = FALSE)
axis(1, tcl = 0, at = seq(1880, 2000, 40), padj = -0.5)
axis(4, tcl = -0.25, at = seq(10, 30, 10), las = 1)
mtext(side = 1, &quot;Year&quot;, line = 2.25, cex = 1)
box()
</code></pre>

<p><img src="figure/unnamed-chunk-23.png" alt="plot of chunk unnamed-chunk-23"/> </p>

<pre><code class="r">
# dev.off()
</code></pre>

<p>Fit 2D-GAMS</p>

<pre><code class="r">
# pad the few 0s for log plotting

dendro.5sp$rBAI[dendro.5sp$rBAI == 0] &lt;- 1e-04
# add birth year (Byear) to dendro.5sp

birthyr.table &lt;- tapply(dendro.5sp$Year, list(dendro.5sp$TreeNum), min)
birthyr.TreeNum &lt;- as.numeric(names(birthyr.table))
birthyr.Year &lt;- as.integer(birthyr.table)
birthyr &lt;- data.frame(birthyr.TreeNum, birthyr.Year)
names(birthyr) &lt;- c(&quot;TreeNum&quot;, &quot;Byear&quot;)

for (n in unique(dendro.5sp$TreeNum)) {
    len &lt;- length(dendro.5sp[dendro.5sp$TreeNum == n, 1])
    dendro.5sp$Byear[dendro.5sp$TreeNum == n] &lt;- rep(birthyr$Byear[birthyr$TreeNum == 
        n], len)
}

species &lt;- levels(dendro.5sp$Code)


for (tr in species) {
    dt &lt;- subset(dendro.5sp, Code == tr)
    o &lt;- table(dt$Byear)
    o &lt;- o[o &gt; 1]

    ## For trees with same birth year, add 0.1 (to jitter)##
    for (k in as.numeric(names(o))) {
        x &lt;- unique(dt[dt$Byear == k, ]$TreeNum)
        z &lt;- 0
        for (j in x) {
            dt[dt$TreeNum == j, ]$Year &lt;- dt[dt$TreeNum == j, ]$Year + z
            z &lt;- z + 0.1
        }
    }
}

dendro.5sp$rBAI2 &lt;- dendro.5sp$rBAI
dendro.5sp$rBAI2[is.na(dendro.5sp$rBAI2)] &lt;- 1

head(dendro.5sp)
</code></pre>

<pre><code>##   Plot Genus Species Code TreeNum Year mmperyear     GenSpec gpyr Age
## 1    1  Acer  rubrum Acer     532 1935     1.275 Acer rubrum 1935   0
## 2    1  Acer  rubrum Acer     532 1936     1.519 Acer rubrum 1940   1
## 3    1  Acer  rubrum Acer     532 1937     1.375 Acer rubrum 1940   2
## 4    1  Acer  rubrum Acer     532 1938     0.891 Acer rubrum 1940   3
## 5    1  Acer  rubrum Acer     532 1939     0.737 Acer rubrum 1940   4
## 6    1  Acer  rubrum Acer     532 1940     1.139 Acer rubrum 1940   5
##   Radius    BAI  block  canopy   rBAI Byear  rBAI2
## 1  1.275  5.107 Valley Hemlock     NA  1935  1.000
## 2  2.794 19.418 Valley Hemlock 15.229  1935 15.229
## 3  4.169 30.078 Valley Hemlock 10.765  1935 10.765
## 4  5.060 25.833 Valley Hemlock  6.197  1935  6.197
## 5  5.797 25.138 Valley Hemlock  4.968  1935  4.968
## 6  6.936 45.562 Valley Hemlock  7.860  1935  7.860
</code></pre>

<pre><code class="r">
gam.acer2 &lt;- gam(rBAI ~ s(Year, Age), data = subset(dendro.5sp, Code == &quot;Acer&quot;))
gam.betula2 &lt;- gam(rBAI ~ s(Year, Age), data = subset(dendro.5sp, Code == &quot;Betula&quot;))
gam.quercus2 &lt;- gam(rBAI ~ s(Year, Age), data = subset(dendro.5sp, Code == &quot;Quercus&quot;))
gam.pinus2 &lt;- gam(rBAI ~ s(Year, Age), data = subset(dendro.5sp, Code == &quot;Pinus&quot;))
gam.tsuga2 &lt;- gam(rBAI ~ s(Year, Age), data = subset(dendro.5sp, Code == &quot;Tsuga&quot;))


## build contour plots of the predictions of the 2d gams

## Acer rubrum

minYr &lt;- min(dendro.5sp$Year[dendro.5sp$Code == &quot;Acer&quot;])
maxAge &lt;- max(dendro.5sp$Age[dendro.5sp$Code == &quot;Acer&quot;])
maxBirthYr &lt;- max(dendro.5sp$Byear[dendro.5sp$Code == &quot;Acer&quot;])
Year &lt;- c(minYr:2004)
Age &lt;- c(0:maxAge)
XY &lt;- expand.grid(Year, Age)
names(XY) &lt;- c(&quot;Year&quot;, &quot;Age&quot;)

pred &lt;- predict(gam.acer2, newdata = XY)
XY$rBAI &lt;- pred
newXY.acer &lt;- XY[XY$Year - minYr &gt;= XY$Age &amp; XY$Year - maxBirthYr &lt;= XY$Age, 
    ]

## Betula lenta

minYr &lt;- min(dendro.5sp$Year[dendro.5sp$Code == &quot;Betula&quot;])
maxAge &lt;- max(dendro.5sp$Age[dendro.5sp$Code == &quot;Betula&quot;])
maxBirthYr &lt;- max(dendro.5sp$Byear[dendro.5sp$Code == &quot;Betula&quot;])
Year &lt;- c(minYr:2004)
Age &lt;- c(0:maxAge)
XY &lt;- expand.grid(Year, Age)
names(XY) &lt;- c(&quot;Year&quot;, &quot;Age&quot;)

pred &lt;- predict(gam.betula2, newdata = XY)
XY$rBAI &lt;- pred
newXY.betula &lt;- XY[XY$Year - minYr &gt;= XY$Age &amp; XY$Year - maxBirthYr &lt;= XY$Age, 
    ]

## Quercus rubra

minYr &lt;- min(dendro.5sp$Year[dendro.5sp$Code == &quot;Quercus&quot;])
maxAge &lt;- max(dendro.5sp$Age[dendro.5sp$Code == &quot;Quercus&quot;])
maxBirthYr &lt;- max(dendro.5sp$Byear[dendro.5sp$Code == &quot;Quercus&quot;])
Year &lt;- c(minYr:2004)
Age &lt;- c(0:maxAge)
XY &lt;- expand.grid(Year, Age)
names(XY) &lt;- c(&quot;Year&quot;, &quot;Age&quot;)

pred &lt;- predict(gam.quercus2, newdata = XY)
XY$rBAI &lt;- pred
newXY.quercus &lt;- XY[XY$Year - minYr &gt;= XY$Age &amp; XY$Year - maxBirthYr &lt;= XY$Age, 
    ]

## Pinus strobus

minYr &lt;- min(dendro.5sp$Year[dendro.5sp$Code == &quot;Pinus&quot;])
maxAge &lt;- max(dendro.5sp$Age[dendro.5sp$Code == &quot;Pinus&quot;])
maxBirthYr &lt;- max(dendro.5sp$Byear[dendro.5sp$Code == &quot;Pinus&quot;])
Year &lt;- c(minYr:2004)
Age &lt;- c(0:maxAge)
XY &lt;- expand.grid(Year, Age)
names(XY) &lt;- c(&quot;Year&quot;, &quot;Age&quot;)

pred &lt;- predict(gam.pinus2, newdata = XY)
XY$rBAI &lt;- pred
newXY.pinus &lt;- XY[XY$Year - minYr &gt;= XY$Age &amp; XY$Year - maxBirthYr &lt;= XY$Age, 
    ]

## Tsuga canadensis

minYr &lt;- min(dendro.5sp$Year[dendro.5sp$Code == &quot;Tsuga&quot;])
maxAge &lt;- max(dendro.5sp$Age[dendro.5sp$Code == &quot;Tsuga&quot;])
maxBirthYr &lt;- max(dendro.5sp$Byear[dendro.5sp$Code == &quot;Tsuga&quot;])
Year &lt;- c(minYr:2004)
Age &lt;- c(0:maxAge)
XY &lt;- expand.grid(Year, Age)
names(XY) &lt;- c(&quot;Year&quot;, &quot;Age&quot;)

pred &lt;- predict(gam.tsuga2, newdata = XY)
XY$rBAI &lt;- pred
newXY.tsuga &lt;- XY[XY$Year - minYr &gt;= XY$Age &amp; XY$Year - maxBirthYr &lt;= XY$Age, 
    ]

# Contour plots

# Acer

a.cont &lt;- ggplot(data = newXY.acer, aes(Year, Age, z = rBAI, xmin = 1860, ymax = 120)) + 

# add environmental markers

geom_rect(xmin = 1910, xmax = 1915, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
    alpha = 0.3, inherit.aes = FALSE) + geom_rect(xmin = 1925, xmax = 1932, 
    ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, alpha = 0.3, inherit.aes = FALSE) + 
    geom_rect(xmin = 1962, xmax = 1966, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
        alpha = 0.3, inherit.aes = FALSE) + geom_vline(xintercept = 1938, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + geom_vline(xintercept = 1981, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + 

geom_tile(aes(fill = rBAI)) + geom_contour(colour = &quot;black&quot;, linetype = 0) + 
    scale_fill_gradient(low = &quot;yellow&quot;, high = &quot;red&quot;, name = &quot;rBAI&quot;) + labs(x = &quot;Year&quot;, 
    y = &quot;Age&quot;) + theme_bw() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), 
    axis.text.x = element_blank(), axis.title.y = element_blank(), axis.text.y = element_text(size = 6), 
    axis.ticks.length = unit(1, &quot;mm&quot;), axis.ticks = element_line(size = 0.25)) + 
    scale_x_continuous(breaks = seq(1880, 2000, 40)) + scale_y_continuous(breaks = seq(0, 
    120, 20))

# Betula

b.cont &lt;- ggplot(data = newXY.betula, aes(Year, Age, z = rBAI, xmin = 1860, 
    ymax = 120)) + 
# add environmental markers

geom_rect(xmin = 1910, xmax = 1915, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
    alpha = 0.3, inherit.aes = FALSE) + geom_rect(xmin = 1925, xmax = 1932, 
    ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, alpha = 0.3, inherit.aes = FALSE) + 
    geom_rect(xmin = 1962, xmax = 1966, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
        alpha = 0.3, inherit.aes = FALSE) + geom_vline(xintercept = 1938, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + geom_vline(xintercept = 1981, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + 
geom_tile(aes(fill = rBAI)) + geom_contour(colour = &quot;black&quot;, linetype = 0) + 
    scale_fill_gradient(low = &quot;yellow&quot;, high = &quot;red&quot;, name = &quot;rBAI&quot;) + labs(x = &quot;Year&quot;, 
    y = &quot;Age&quot;) + theme_bw() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), 
    axis.text.x = element_blank(), axis.title.y = element_blank(), axis.text.y = element_text(size = 6), 
    axis.ticks.length = unit(1, &quot;mm&quot;), axis.ticks = element_line(size = 0.25)) + 
    scale_x_continuous(breaks = seq(1880, 2000, 40)) + scale_y_continuous(breaks = seq(0, 
    120, 20))

# Quercus

q.cont &lt;- ggplot(data = newXY.quercus, aes(Year, Age, z = rBAI, xmin = 1860, 
    ymax = 100)) + 
# add environmental markers

geom_rect(xmin = 1910, xmax = 1915, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
    alpha = 0.3, inherit.aes = FALSE) + geom_rect(xmin = 1925, xmax = 1932, 
    ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, alpha = 0.3, inherit.aes = FALSE) + 
    geom_rect(xmin = 1962, xmax = 1966, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
        alpha = 0.3, inherit.aes = FALSE) + geom_vline(xintercept = 1938, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + geom_vline(xintercept = 1981, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + 
geom_tile(aes(fill = rBAI)) + geom_contour(colour = &quot;black&quot;, linetype = 0) + 
    scale_fill_gradient(low = &quot;yellow&quot;, high = &quot;red&quot;, name = &quot;rBAI&quot;) + labs(x = &quot;Year&quot;, 
    y = &quot;Age&quot;) + theme_bw() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), 
    axis.text.x = element_blank(), axis.title.y = element_blank(), axis.text.y = element_text(size = 6), 
    axis.ticks.length = unit(1, &quot;mm&quot;), axis.ticks = element_line(size = 0.25)) + 
    scale_x_continuous(breaks = seq(1880, 2000, 40)) + scale_y_continuous(breaks = seq(0, 
    100, 20))

# Pinus

p.cont &lt;- ggplot(data = newXY.pinus, aes(Year, Age, z = rBAI, xmin = 1860, ymax = 100)) + 

# add environmental markers

geom_rect(xmin = 1910, xmax = 1915, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
    alpha = 0.3, inherit.aes = FALSE) + geom_rect(xmin = 1925, xmax = 1932, 
    ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, alpha = 0.3, inherit.aes = FALSE) + 
    geom_rect(xmin = 1962, xmax = 1966, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
        alpha = 0.3, inherit.aes = FALSE) + geom_vline(xintercept = 1938, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + geom_vline(xintercept = 1981, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + 
geom_tile(aes(fill = rBAI)) + geom_contour(colour = &quot;black&quot;, linetype = 0) + 
    scale_fill_gradient(low = &quot;yellow&quot;, high = &quot;red&quot;, name = &quot;rBAI&quot;) + labs(x = &quot;Year&quot;, 
    y = &quot;Age&quot;) + theme_bw() + theme(legend.position = &quot;none&quot;, axis.title.x = element_text(size = 8), 
    axis.text.x = element_text(size = 6), axis.title.y = element_text(colour = &quot;white&quot;), 
    axis.text.y = element_text(size = 6), axis.ticks.length = unit(1, &quot;mm&quot;), 
    axis.ticks = element_line(size = 0.25)) + scale_x_continuous(breaks = seq(1880, 
    2000, 40)) + scale_y_continuous(breaks = seq(0, 120, 20))

# Tsuga

t.cont &lt;- ggplot(data = newXY.tsuga, aes(Year, Age, z = rBAI, xmin = 1860, ymax = 140)) + 

# add environmental markers

geom_rect(xmin = 1910, xmax = 1915, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
    alpha = 0.3, inherit.aes = FALSE) + geom_rect(xmin = 1925, xmax = 1932, 
    ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, alpha = 0.3, inherit.aes = FALSE) + 
    geom_rect(xmin = 1962, xmax = 1966, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
        alpha = 0.3, inherit.aes = FALSE) + geom_vline(xintercept = 1938, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + geom_vline(xintercept = 1981, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + 
geom_tile(aes(fill = rBAI)) + geom_contour(colour = &quot;black&quot;, linetype = 0) + 
    scale_fill_gradient(low = &quot;yellow&quot;, high = &quot;red&quot;, name = &quot;rBAI&quot;) + labs(x = &quot;Year&quot;, 
    y = &quot;Age&quot;) + theme_bw() + theme(legend.position = &quot;none&quot;, axis.title.x = element_blank(), 
    axis.text.x = element_blank(), axis.title.y = element_blank(), axis.text.y = element_text(size = 6), 
    axis.ticks.length = unit(1, &quot;mm&quot;), axis.ticks = element_line(size = 0.25)) + 
    scale_x_continuous(breaks = seq(1880, 2000, 40)) + scale_y_continuous(breaks = seq(0, 
    140, 20))


# line plots

t.lines &lt;- ggplot(data = dendro.5sp[dendro.5sp$Code == &quot;Tsuga&quot;, ], aes(x = Year, 
    y = Age, group = TreeNum, geom = &quot;line&quot;, xmin = 1860, ymax = 140, color = rBAI2, 
    xlab = &quot;&quot;, ylab = &quot;Age&quot;)) + 
# add environmental markers

geom_rect(xmin = 1910, xmax = 1915, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
    alpha = 0.3, inherit.aes = FALSE) + geom_rect(xmin = 1925, xmax = 1932, 
    ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, alpha = 0.3, inherit.aes = FALSE) + 
    geom_rect(xmin = 1962, xmax = 1966, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
        alpha = 0.3, inherit.aes = FALSE) + geom_vline(xintercept = 1938, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + geom_vline(xintercept = 1981, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + 
geom_line(size = 1) + scale_colour_gradientn(colours = c(&quot;yellow&quot;, &quot;orange&quot;, 
    &quot;orangered&quot;, &quot;red&quot;, &quot;darkred&quot;)) + theme_bw() + theme(legend.position = &quot;none&quot;, 
    axis.title.x = element_blank(), axis.text.x = element_blank(), axis.title.y = element_text(colour = &quot;white&quot;), 
    axis.text.y = element_text(size = 6), axis.ticks.length = unit(1, &quot;mm&quot;), 
    axis.ticks = element_line(size = 0.25)) + scale_x_continuous(breaks = seq(1880, 
    2000, 40)) + scale_y_continuous(breaks = seq(0, 140, 20)) + annotate(&quot;text&quot;, 
    label = &quot;Tsuga&quot;, x = 1870, y = 122, size = 2, colour = &quot;black&quot;, fontface = 3)

b.lines &lt;- ggplot(data = dendro.5sp[dendro.5sp$Code == &quot;Betula&quot;, ], aes(x = Year, 
    y = Age, group = TreeNum, geom = &quot;line&quot;, xmin = 1860, ymax = 120, color = rBAI2, 
    xlab = &quot;&quot;, ylab = &quot;Age&quot;)) + 
# add environmental markers

geom_rect(xmin = 1910, xmax = 1915, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
    alpha = 0.3, inherit.aes = FALSE) + geom_rect(xmin = 1925, xmax = 1932, 
    ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, alpha = 0.3, inherit.aes = FALSE) + 
    geom_rect(xmin = 1962, xmax = 1966, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
        alpha = 0.3, inherit.aes = FALSE) + geom_vline(xintercept = 1938, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + geom_vline(xintercept = 1981, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + 
geom_line(size = 1) + scale_colour_gradientn(colours = c(&quot;yellow&quot;, &quot;orange&quot;, 
    &quot;orangered&quot;, &quot;red&quot;, &quot;darkred&quot;)) + theme_bw() + theme(legend.position = &quot;none&quot;, 
    axis.title.x = element_blank(), axis.text.x = element_blank(), axis.title.y = element_text(colour = &quot;white&quot;), 
    axis.text.y = element_text(size = 6), axis.ticks.length = unit(1, &quot;mm&quot;), 
    axis.ticks = element_line(size = 0.25)) + scale_x_continuous(breaks = seq(1880, 
    2000, 40)) + scale_y_continuous(breaks = seq(0, 120, 20)) + annotate(&quot;text&quot;, 
    label = &quot;Betula&quot;, x = 1870, y = 102, size = 2, colour = &quot;black&quot;, fontface = 3)

q.lines &lt;- ggplot(data = dendro.5sp[dendro.5sp$Code == &quot;Quercus&quot;, ], aes(x = Year, 
    y = Age, group = TreeNum, geom = &quot;line&quot;, xmin = 1860, ymax = 100, color = rBAI2, 
    xlab = &quot;&quot;, ylab = &quot;Age&quot;)) + 
# add environmental markers

geom_rect(xmin = 1910, xmax = 1915, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
    alpha = 0.3, inherit.aes = FALSE) + geom_rect(xmin = 1925, xmax = 1932, 
    ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, alpha = 0.3, inherit.aes = FALSE) + 
    geom_rect(xmin = 1962, xmax = 1966, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
        alpha = 0.3, inherit.aes = FALSE) + geom_vline(xintercept = 1938, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + geom_vline(xintercept = 1981, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + 
geom_line(size = 1) + scale_colour_gradientn(colours = c(&quot;yellow&quot;, &quot;orange&quot;, 
    &quot;orangered&quot;, &quot;red&quot;, &quot;darkred&quot;)) + theme_bw() + theme(legend.position = &quot;none&quot;, 
    axis.title.x = element_blank(), axis.title.y = element_text(size = 8), axis.text.x = element_blank(), 
    axis.text.y = element_text(size = 6), axis.ticks.length = unit(1, &quot;mm&quot;), 
    axis.ticks = element_line(size = 0.25)) + scale_x_continuous(breaks = seq(1880, 
    2000, 40)) + scale_y_continuous(breaks = seq(0, 100, 20)) + annotate(&quot;text&quot;, 
    label = &quot;Quercus&quot;, x = 1875, y = 82, size = 2, colour = &quot;black&quot;, fontface = 3)

a.lines &lt;- ggplot(data = dendro.5sp[dendro.5sp$Code == &quot;Acer&quot;, ], aes(x = Year, 
    y = Age, group = TreeNum, geom = &quot;line&quot;, xmin = 1860, ymax = 120, color = rBAI2, 
    xlab = &quot;&quot;, ylab = &quot;Age&quot;)) + 
# add environmental markers

geom_rect(xmin = 1910, xmax = 1915, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
    alpha = 0.3, inherit.aes = FALSE) + geom_rect(xmin = 1925, xmax = 1932, 
    ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, alpha = 0.3, inherit.aes = FALSE) + 
    geom_rect(xmin = 1962, xmax = 1966, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
        alpha = 0.3, inherit.aes = FALSE) + geom_vline(xintercept = 1938, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + geom_vline(xintercept = 1981, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + 
geom_line(size = 1) + scale_colour_gradientn(colours = c(&quot;yellow&quot;, &quot;orange&quot;, 
    &quot;orangered&quot;, &quot;red&quot;, &quot;darkred&quot;)) + theme_bw() + theme(legend.position = &quot;none&quot;, 
    axis.title.x = element_blank(), axis.text.x = element_blank(), axis.title.y = element_text(colour = &quot;white&quot;), 
    axis.text.y = element_text(size = 6), axis.ticks.length = unit(1, &quot;mm&quot;), 
    axis.ticks = element_line(size = 0.25)) + scale_x_continuous(breaks = seq(1880, 
    2000, 40)) + scale_y_continuous(breaks = seq(0, 120, 20)) + annotate(&quot;text&quot;, 
    label = &quot;Acer&quot;, x = 1870, y = 102, size = 2, colour = &quot;black&quot;, fontface = 3)

p.lines &lt;- ggplot(data = dendro.5sp[dendro.5sp$Code == &quot;Pinus&quot;, ], aes(x = Year, 
    y = Age, group = TreeNum, geom = &quot;line&quot;, xmin = 1860, ymax = 100, color = rBAI2, 
    xlab = &quot;Year&quot;, ylab = &quot;Age&quot;)) + 
# add environmental markers

geom_rect(xmin = 1910, xmax = 1915, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
    alpha = 0.3, inherit.aes = FALSE) + geom_rect(xmin = 1925, xmax = 1932, 
    ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, alpha = 0.3, inherit.aes = FALSE) + 
    geom_rect(xmin = 1962, xmax = 1966, ymin = -Inf, ymax = Inf, fill = &quot;pink&quot;, 
        alpha = 0.3, inherit.aes = FALSE) + geom_vline(xintercept = 1938, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + geom_vline(xintercept = 1981, color = &quot;grey50&quot;, 
    linetype = 2, size = 0.25) + 
geom_line(size = 1) + scale_colour_gradientn(colours = c(&quot;yellow&quot;, &quot;orange&quot;, 
    &quot;orangered&quot;, &quot;red&quot;, &quot;darkred&quot;)) + theme_bw() + theme(legend.position = &quot;none&quot;, 
    axis.title.x = element_text(size = 8), axis.text.x = element_text(size = 6), 
    axis.title.y = element_text(colour = &quot;white&quot;), axis.text.y = element_text(size = 6), 
    axis.ticks.length = unit(1, &quot;mm&quot;), axis.ticks = element_line(size = 0.25)) + 
    scale_x_continuous(breaks = seq(1880, 2000, 40)) + scale_y_continuous(breaks = seq(0, 
    100, 20)) + annotate(&quot;text&quot;, label = &quot;Pinus&quot;, x = 1870, y = 82, size = 2, 
    colour = &quot;black&quot;, fontface = 3)



# pdf(&#39;Figure-11-countours-v2.pdf&#39;, height=6, width=4)
multiplot(t.lines, b.lines, q.lines, a.lines, p.lines, t.cont, b.cont, q.cont, 
    a.cont, p.cont, cols = 2)
</code></pre>

<p><img src="figure/unnamed-chunk-25.png" alt="plot of chunk unnamed-chunk-25"/> </p>

<pre><code class="r"># dev.off()
</code></pre>

<p>Extract deviance from and compare the 1-d and 2-d GAMs</p>

<pre><code class="r">1 - gam.acer1$deviance/gam.acer1$null.deviance
</code></pre>

<pre><code>## [1] 0.2583
</code></pre>

<pre><code class="r">1 - gam.acer2$deviance/gam.acer1$null.deviance
</code></pre>

<pre><code>## [1] 0.2601
</code></pre>

<pre><code class="r">AIC(gam.acer1, gam.acer2)
</code></pre>

<pre><code>##               df   AIC
## gam.acer1 118.00 13156
## gam.acer2  26.63 12968
</code></pre>

<pre><code class="r">
1 - gam.betula1$deviance/gam.betula1$null.deviance
</code></pre>

<pre><code>## [1] 0.3788
</code></pre>

<pre><code class="r">1 - gam.betula2$deviance/gam.betula1$null.deviance
</code></pre>

<pre><code>## [1] 0.4528
</code></pre>

<pre><code class="r">AIC(gam.betula1, gam.betula2)
</code></pre>

<pre><code>##                 df   AIC
## gam.betula1 125.00 13176
## gam.betula2  29.28 12728
</code></pre>

<pre><code class="r">
1 - gam.quercus1$deviance/gam.quercus1$null.deviance
</code></pre>

<pre><code>## [1] 0.333
</code></pre>

<pre><code class="r">1 - gam.quercus2$deviance/gam.quercus1$null.deviance
</code></pre>

<pre><code>## [1] 0.4169
</code></pre>

<pre><code class="r">AIC(gam.quercus1, gam.quercus2)
</code></pre>

<pre><code>##                 df  AIC
## gam.quercus1 106.0 7989
## gam.quercus2  27.3 7671
</code></pre>

<pre><code class="r">
1 - gam.pinus1$deviance/gam.pinus1$null.deviance
</code></pre>

<pre><code>## [1] 0.297
</code></pre>

<pre><code class="r">1 - gam.pinus2$deviance/gam.pinus1$null.deviance
</code></pre>

<pre><code>## [1] 0.3942
</code></pre>

<pre><code class="r">AIC(gam.pinus1, gam.pinus2)
</code></pre>

<pre><code>##                df  AIC
## gam.pinus1 108.00 7227
## gam.pinus2  27.62 6930
</code></pre>

<pre><code class="r">
1 - gam.tsuga1$deviance/gam.tsuga1$null.deviance
</code></pre>

<pre><code>## [1] 0.2453
</code></pre>

<pre><code class="r">1 - gam.tsuga2$deviance/gam.tsuga1$null.deviance
</code></pre>

<pre><code>## [1] 0.2492
</code></pre>

<pre><code class="r">AIC(gam.tsuga1, gam.tsuga2)
</code></pre>

<pre><code>##                df   AIC
## gam.tsuga1 146.00 65388
## gam.tsuga2  30.22 65107
</code></pre>

</body>

</html>

